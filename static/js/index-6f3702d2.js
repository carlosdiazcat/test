import{b as e,r as l,l as a,w as i,cd as o,bj as t,ce as r,bn as n,bA as d,cc as s,bw as u,bx as m,bB as c,bh as h,b4 as p,b5 as g,bd as _,b7 as v,v as w,ba as b,q as f,bc as A,be as y,bf as k,F as S,b9 as $,bl as C}from"./Akubela-element-plus-Vendor-47553b40.js";import{j as D,u as V,w as x,n as R,m as I,P as L,a as E,g as N,al as T,s as U}from"./Akubela-login-home-part-Vendor-facddf88.js";import"./Akubela-devices-img-Vendor-0f46fa2c.js";import"./Akubela-scenes-security-other-img-Vendor-2a1534ad.js";const z={class:"group-control-index"},B={class:"group-control-top"},O=["src"],j={class:"group-control-top__title"},M={class:"group-control-container"},F={class:"top-part"},G={class:"light-span-add","akubela-test":"light-add"},q={class:"light-span-delete","akubela-test":"light-add-delete"},H={class:"update-fail__div"},P={__name:"index",setup(P){let J=D();const{t:K}=V();let Q=x();const W={expandTrigger:"hover",value:"area_id",label:"name"},X=e({recevieData:{},options:{},dialogloading:!1,loading:!1,is_add:!1,diaShow:!1,multipleSelection:[],tableData:[],newRoomList:[],del:!1,isShowNameRe:!1}),Y=e({device_id:"",name:"",area_id:[],lowArr:[],mediumArr:[],highArr:[]}),Z={lowArr:[],mediumArr:[],highArr:[]},ee=l(),le=(e,l)=>{if(l.includes("All")&&l.length>Z[e].length){const l=[];X.options.forEach((e=>{l.push(e.entity_id)})),Y[e]=l,Z[e]=l}else if(l.includes("All")&&l.length<Z[e].length){const a=[];l.forEach((e=>{"All"!==e&&a.push(e)})),Y[e]=a,Z[e]=a}else!l.includes("All")&&Z[e].includes("All")&&l.length<Z[e].length?(Y[e]=[],Z[e]=[]):Y[e].includes("All")||(Y[e]=l,Z[e]=l)},ae=e=>e.area_id?e.area_name?K("areaname - name",{areaname:e.area_name,name:e.name}):e.name:K("areaname - name",{areaname:K("Other"),name:e.name}),ie=()=>({color:"#5D5D5D"}),oe=()=>({fontSize:"12px",color:"#000000"}),te=e=>{X.multipleSelection=e};a((()=>{be()}));const re=()=>{var e;let l=[];if(!Y.area_id.length)return null==(e=null==l?void 0:l.push)||e.call(l,"Other"),void(Y.area_id=l);const a=Y.area_id[Y.area_id.length-1];J.newRoomList.forEach((e=>{var i,o;(null==e?void 0:e.area_id)===a&&(null==(i=null==l?void 0:l.push)||i.call(l,null==e?void 0:e.area_id)),(null==(o=null==e?void 0:e.children)?void 0:o.length)>0&&e.children.forEach((i=>{(null==i?void 0:i.area_id)===a&&(l=[e.area_id,i.area_id])}))})),Y.area_id=l},ne=(e,l)=>{var a;X.recevieData[Q.wId]=a=>{if(X.dialogloading=!1,!a.success)return R(K("errorMessage"),"error");X.options=[{entity_id:"All",name:K("Select All"),area_name:"",area_id:"1"},...a.result],de(e,l),(()=>{var e,l,a,i;X.newRoomList=null==(i=null==(a=null==(l=null==(e=J.newRoomList)?void 0:e.map)?void 0:l.call(e,(e=>{const l=["Other","all","public"].includes(e.area_id)?K(e.name):e.name;return{...e,name:l}})))?void 0:a.filter)?void 0:i.call(a,(e=>!("all"===e.area_id||"public"===e.area_id))),X.is_add||re()})(),X.diaShow=!0},X.dialogloading=!0,setTimeout((()=>{X.dialogloading=!1}),15e3);const i={type:"ak_device/level_ctrl/options",id:Q.wId++};null==(a=Q.ws)||a.send(I(i))},de=(e,l)=>{if("Add"===e)X.is_add=!0,Y.name="",Y.area_id=["Other"],Y.device_id="",Y.highArr=[],Y.mediumArr=[],Y.lowArr=[],Z.lowArr=[],Z.mediumArr=[],Z.highArr=[];else{X.is_add=!1;const e=l.ctrl_info;if(Y.device_id=l.device_id,e.low.length+1===X.options.length){const l=ue(e.low);Z.lowArr=l,Y.lowArr=l}else Z.lowArr=e.low,Y.lowArr=e.low;if(e.medium.length+1===X.options.length){const l=ue(e.medium);Z.mediumArr=l,Y.mediumArr=l}else Z.mediumArr=e.medium,Y.mediumArr=e.medium;if(e.high.length+1===X.options.length){const l=ue(e.high);Z.highArr=l,Y.highArr=l}else Z.highArr=e.high,Y.highArr=e.high;Y.area_id=l.area_id?[l.area_id]:["Other"],Y.name=l.name}},se=async(e,l)=>{ne(e,l)},ue=e=>["All",...e],me=()=>{X.multipleSelection.forEach((e=>{var l;X.recevieData[Q.wId]=e=>{if(!e.success)return R(K("errorMessage"),"error")};const a={type:"config/ak_device/delete",id:Q.wId++,device_id:e.device_id};null==(l=Q.ws)||l.send(I(a))})),setTimeout((()=>{X.del=!1,be()}),2500)},ce=()=>{if(!X.multipleSelection.length)return R(K("pleaseSelect"),"error");X.del=!0},he=e({name:[{validator:(e,l,a)=>(Y.name=null==l?void 0:l.replace(T.regSpace,""),Y.name?a():a(new Error(K("nameEmpty")))),trigger:["blur","change"]}],area_id:[{validator:(e,l,a)=>{a()},trigger:["blur","change"]}]}),pe=()=>{X.isShowNameRe=!1},ge=()=>{X.isShowNameRe=!1,ve()},_e=()=>{var e,l,a,i;(null==(i=null==(a=null==(l=null==(e=null==J?void 0:J.devicesList)?void 0:e.filter)?void 0:l.call(e,(e=>e.device_id!==Y.device_id)))?void 0:a.some)?void 0:i.call(a,(e=>e.name===Y.name)))?X.isShowNameRe=!0:ve()},ve=()=>{ee.value.validate((async e=>{var l;if(e){X.recevieData[Q.wId]=e=>{if(X.dialogloading=!1,!e.success)return R(K("errorMessage"),"error");X.diaShow=!1,R(K("successfully")),X.is_add?setTimeout((()=>{be()}),2e3):be()},X.dialogloading=!0,setTimeout((()=>{X.dialogloading=!1}),15e3);const e=Y.area_id.length?Y.area_id[Y.area_id.length-1]:"";let a={};a=X.is_add?{type:"ak_device/level_ctrl/add",id:Q.wId++,name:Y.name,area_id:"Other"===e?"":e,ctrl_info:{low:we(Y.lowArr)||[],medium:we(Y.mediumArr)||[],high:we(Y.highArr)||[]}}:{type:"ak_device/level_ctrl/set",id:Q.wId++,device_id:Y.device_id,name:Y.name,area_id:"Other"===e?"":e,ctrl_info:{low:we(Y.lowArr)||[],medium:we(Y.mediumArr)||[],high:we(Y.highArr)||[]}},null==(l=Q.ws)||l.send(I(a))}}))},we=e=>e.filter((e=>"All"!==e)),be=()=>{var e;X.recevieData[Q.wId]=e=>{if(X.loading=!1,!e.success)return R(K("errorMessage"),"error");const l=[];for(const[a,i]of e.result.entries())l.push({index:a+1,...i});X.tableData=l},X.loading=!0,setTimeout((()=>{X.loading=!1}),15e3);const l={type:"ak_device/level_ctrl/get",id:Q.wId++};null==(e=Q.ws)||e.send(I(l))};return i((()=>Q.updataId),(e=>{U(X.recevieData,e,Q)}),{immediate:!0}),(e,l)=>{const a=o,i=t,D=r,V=n,x=d,R=s,I=u,T=m,U=c,P=h;return p(),g(S,null,[_((p(),g("div",z,[v("div",B,[v("img",{alt:"smart home,home automation,homekit,smart security,smart home systems,google home",class:"group-control-top__icon",src:w(N)("dimming_group_title.webp")},null,8,O),v("span",j,b(e.$t("DimmingGroup")),1)]),v("div",M,[v("div",F,[f(L,{"class-name":"primary","button-name":"",onClick:l[0]||(l[0]=e=>se("Add"))},{prefix:A((()=>[v("span",G,b(e.$t("Add")),1)])),_:1}),f(L,{"class-name":X.multipleSelection.length?"success":"disabled","button-name":"",onClick:ce},{prefix:A((()=>[v("span",q,b(e.$t("Delete")),1)])),_:1},8,["class-name"])]),f(D,{ref:"multipleTableRef",size:"large","header-cell-style":ie,"cell-style":oe,class:"table-part","max-height":"calc(100vh - 169px)","highlight-current-row":"","scrollbar-always-on":"",data:X.tableData,style:{width:"100%"},onSelectionChange:te},{default:A((()=>[f(a,{type:"selection",width:"55"}),f(a,{prop:"index",label:e.$t("Index")},null,8,["label"]),f(a,{prop:"name",label:e.$t("Device Name")},null,8,["label"]),f(a,{fixed:"right",label:e.$t("edit"),width:"150"},{default:A((l=>[f(i,{link:"",type:"primary",size:"small",onClick:e=>se("Edit",l.row)},{default:A((()=>[$(b(e.$t("edit")),1)])),_:2},1032,["onClick"])])),_:1},8,["label"])])),_:1},8,["data"])])])),[[P,X.loading]]),X.diaShow?_((p(),y(E,{key:0,show:X.diaShow,"onUpdate:show":l[9]||(l[9]=e=>X.diaShow=e),"close-ok-loading":!0,class:"group-control-dialog-index",title:X.is_add?e.$t("Add Dimming Group"):e.$t("Edit Dimming Group"),onButtonCancel:l[10]||(l[10]=e=>X.diaShow=!1),onButtonConfirm:_e},{content:A((()=>[f(U,{ref_key:"ruleFormRef",ref:ee,model:Y,rules:he,"label-width":"200",class:"dialog-ruleForm",size:"large"},{default:A((()=>[f(x,{label:e.$t("Device Name"),prop:"name"},{default:A((()=>[f(V,{modelValue:Y.name,"onUpdate:modelValue":l[1]||(l[1]=e=>Y.name=e),minlength:1,maxlength:63},null,8,["modelValue"])])),_:1},8,["label"]),f(x,{label:e.$t("space"),prop:"area_id"},{default:A((()=>[f(R,{modelValue:Y.area_id,"onUpdate:modelValue":l[2]||(l[2]=e=>Y.area_id=e),"popper-class":"group-control-cascader",options:X.newRoomList,props:W,separator:"-",onChange:e.areaIdChange},null,8,["modelValue","options","onChange"])])),_:1},8,["label"]),f(x,{label:e.$t("LowLight"),prop:"lowArr"},{default:A((()=>[f(T,{modelValue:Y.lowArr,"onUpdate:modelValue":l[3]||(l[3]=e=>Y.lowArr=e),multiple:"","collapse-tags":"","collapse-tags-tooltip":"","popper-class":"pop-dimming-group",placeholder:e.$t("Select"),size:"large",onChange:l[4]||(l[4]=e=>le("lowArr",e))},{default:A((()=>[(p(!0),g(S,null,C(X.options,(e=>(p(),y(I,{key:e.entity_id,label:ae(e),value:e.entity_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),f(x,{label:e.$t("MediumLight"),prop:"mediumArr"},{default:A((()=>[f(T,{modelValue:Y.mediumArr,"onUpdate:modelValue":l[5]||(l[5]=e=>Y.mediumArr=e),multiple:"","collapse-tags":"","collapse-tags-tooltip":"","popper-class":"pop-dimming-group",placeholder:e.$t("Select"),size:"large",onChange:l[6]||(l[6]=e=>le("mediumArr",e))},{default:A((()=>[(p(!0),g(S,null,C(X.options,(e=>(p(),y(I,{key:e.entity_id,label:ae(e),value:e.entity_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),f(x,{label:e.$t("HighLight"),prop:"highArr"},{default:A((()=>[f(T,{modelValue:Y.highArr,"onUpdate:modelValue":l[7]||(l[7]=e=>Y.highArr=e),multiple:"","collapse-tags":"","collapse-tags-tooltip":"","popper-class":"pop-dimming-group",placeholder:e.$t("Select"),size:"large",onChange:l[8]||(l[8]=e=>le("highArr",e))},{default:A((()=>[(p(!0),g(S,null,C(X.options,(e=>(p(),y(I,{key:e.entity_id,label:ae(e),value:e.entity_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model","rules"])])),_:1},8,["show","title"])),[[P,X.dialogloading]]):k("",!0),f(E,{show:X.del,"onUpdate:show":l[11]||(l[11]=e=>X.del=e),title:e.$t("Delete"),"button-ok-name":e.$t("Confirm"),onButtonCancel:l[12]||(l[12]=e=>X.del=!1),onButtonConfirm:me},{content:A((()=>[v("div",H,b(e.$t("Are you sure you want to delete these devices?")),1)])),_:1},8,["show","title","button-ok-name"]),f(E,{show:X.isShowNameRe,"onUpdate:show":l[13]||(l[13]=e=>X.isShowNameRe=e),class:"tip-dia-re","button-cancel-show":!0,"button-ok-name":e.$t("Confirm"),onButtonCancel:pe,onButtonConfirm:ge},{content:A((()=>[v("div",null,b(e.$t("The name already exists. Continue?")),1)])),_:1},8,["show","button-ok-name"])],64)}}};export{P as default};
