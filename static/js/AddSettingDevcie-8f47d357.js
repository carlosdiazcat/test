import{b as e,r as i,j as t,w as a,b4 as l,b5 as n,q as o,bc as d,bd as s,b7 as c,v as r,ba as v,F as u,bl as m,bf as p,be as g,bn as b,cc as h,bw as w,bx as _,bh as y}from"./Akubela-element-plus-Vendor-47553b40.js";import{a4 as f,j as D,u as N,w as O,ak as j,a7 as k,s as S,g as L,aj as I,P as R,a as T,m as C,al as V,n as $,q as A}from"./Akubela-login-home-part-Vendor-facddf88.js";const x={class:"add-setting-device-page"},z={class:"device-setting-last-box"},B={class:"device-setting-box-left"},U={class:"device-setting-avatar"},q=["src"],E={class:"device-setting-left-name"},G={class:"device-setting-box-right"},P={class:"device-box__input"},F={class:"device-setting-choose"},M={class:"device-setting-location"},W={key:0},H={key:0},J={key:1,class:"device-box__input"},K={key:1},Q={class:"device-setting-choose"},X={class:"device-setting-chose-type"},Y={class:"type-content-right-setting"},Z={class:"type-bottom-box-setting"},ee={__name:"AddSettingDevcie",props:{show:{type:Boolean,required:!0,default:!1},replace:{type:Boolean,required:!1,default:!1},deviceType:{type:String,required:!1,default:""}},emits:["update:show","open-dia-show"],setup(ee,{emit:ie}){var te,ae;const le=ee,ne=f();let oe=D();const{t:de}=N();let se=O();const{openDeviceDetail:ce}=j(),re=k(),ve={expandTrigger:"hover",value:"area_id",label:"name"},ue=e({recevieData:{},settingName:"",oldSettingName:"",settingLocation:["Other"],deviceObj:{},choseRelayShow:!1,switchRelay:"",moreSwitchDetail:{},allDeviceList:[],deviceType:"empty",zigbeeTypeList:[],middleArea:[],loading:!1,nowDeviceObj:{},isShowNameRe:!1,addNumber:1}),me=i(""),pe=()=>{ie("open-dia-show"),ie("update:show",!1)},ge=t({get:()=>le.show,set:e=>{ie("update:show",e)}});null==(ae=null==(te=oe.newRoomList)?void 0:te.filter)||ae.call(te,(e=>!("all"===e.area_id||"public"===e.area_id||"Other"===e.area_id)));const be=()=>{ue.settingName=ue.oldSettingName+ue.addNumber.toString(),ue.addNumber=ue.addNumber+1,ue.isShowNameRe=!1},he=()=>{ue.isShowNameRe=!1,we()},we=()=>{var e,i,t;ue.recevieData[se.wId]=De,ue.middleArea=[...ue.settingLocation];const a={type:"config/ak_device/update",id:se.wId++,name:ue.settingName,area_id:null==(i=null==(e=ue.middleArea)?void 0:e.pop)?void 0:i.call(e),device_id:re.nowDeviceObj.deviceId};"Other"===a.area_id&&(a.area_id=""),null==(t=se.ws)||t.send(C(a))},_e=()=>{var e,i;return ue.settingName=ue.settingName.replace(V.regSpace,""),!!ue.settingName&&("Unknown"===(null==(e=ue.deviceObj)?void 0:e.product_type)&&"zigbee"===(null==(i=ue.deviceObj)?void 0:i.product_attributes)&&"empty"===ue.deviceType?$(de("PleaseSelectADeviceTypeBeforeContinue"),"error"):void(ye()?ue.isShowNameRe=!0:he()))},ye=()=>{var e,i,t,a;return null==(a=null==(t=null==(i=null==(e=ue.allDeviceList)?void 0:e.filter)?void 0:i.call(e,(e=>e.device_id!==re.nowDeviceObj.deviceId)))?void 0:t.some)?void 0:a.call(t,(e=>(null==e?void 0:e.name)===ue.settingName))},fe=()=>{var e;if(!ue.settingName)return ue.settingName=(null==(e=ue.nowDeviceObj)?void 0:e.name)||"",$(de("nameEmpty"),"error")},De=e=>{var i,t,a,l;if(!e.success)return"95005001"===(null==(i=null==e?void 0:e.error)?void 0:i.code)?$(de("nameFormat"),"error"):$(de(null==(t=null==e?void 0:e.error)?void 0:t.message),"error");if("Unknown"===(null==(a=ue.deviceObj)?void 0:a.product_type)&&"zigbee"===(null==(l=ue.deviceObj)?void 0:l.product_attributes)){if("empty"===ue.deviceType)return $(de("PleaseSelectADeviceTypeBeforeContinue"),"error");(()=>{var e;ue.recevieData[se.wId]=e=>{if(!e.success)return $(de("errorMessage"),"error")};const i={type:"config/ak_device/update_zigbee_type",id:se.wId++,device_id:ue.deviceObj.device_id,device_type:ue.deviceType};null==(e=se.ws)||e.send(C(i))})()}re.isReplace&&$(de("Replace Successfully")),re.cancelDia(),oe.getDeviceAllList(),"IR Controller"!==oe.deviceCurrent.productType&&(oe.deviceCurrent.dialogVisible=!1),"IR Controller"===oe.deviceCardObj.deviceDetail.device_type&&(oe.fatherDeviceObj=oe.deviceCardObj.deviceDetail,oe.deviceCurrent.dialogVisible=!1,setTimeout((()=>{ce(ue.nowDeviceObj),oe.backtoDetail=!0}),500)),ie("update:show",!1)},Ne=()=>{var e,i,t;ue.recevieData[se.wId]=e=>{if(!e.success)return $(de("errorMessage"),"error")},ue.middleArea=[...ue.settingLocation];const a={type:"config/ak_device/update",id:se.wId++,name:ue.settingName,area_id:null==(i=null==(e=ue.middleArea)?void 0:e.pop)?void 0:i.call(e),device_id:re.nowDeviceObj.deviceId};"Other"===a.area_id&&(a.area_id=""),null==(t=se.ws)||t.send(C(a))},Oe=()=>{var e;ue.recevieData[se.wId]=e=>{e.success&&(ue.zigbeeTypeList=e.result)},null==(e=se.ws)||e.send(C({type:"config/ak_device/zigbee_type_list",id:se.wId++}))},je=()=>{var e,i,t,a,l,n;const o=oe.devicesList.find((e=>e.device_id===re.gateWayDeviceId)),d=null==o?void 0:o.area_id;if("Devices"!==ne.currentRoute.value.name)return ue.settingLocation=["Other"];if(["all","public","Other"].includes(d))return ue.settingLocation=["Other"];const s=null==(i=null==(e=oe.newRoomList)?void 0:e.find)?void 0:i.call(e,(e=>(null==e?void 0:e.area_id)===d));if(s){if((null==(t=null==s?void 0:s.children)?void 0:t.length)>0)return ue.settingLocation=["Other"];if(0===(null==(a=null==s?void 0:s.children)?void 0:a.length))return ue.settingLocation=[s.area_id]}const c=null==(n=null==(l=oe.roomList)?void 0:l.find)?void 0:n.call(l,(e=>(null==e?void 0:e.area_id)===d));return(null==c?void 0:c.parent_id)?ue.settingLocation=[null==c?void 0:c.parent_id,c.area_id]:void 0},ke=()=>{oe.devicesList.forEach((e=>{if(e.name===ue.settingName&&e.device_id!==re.nowDeviceObj.deviceId){const e=ue.settingName.split("_"),i=e[e.length-1];if(A(i)){let t=parseInt(i,10)+1;const a=t<10?"0"+t:t.toString();let l="";for(let i=0;i<e.length-1;i++)l+=e[i];const n=l+"_"+a;ue.settingName=n,ue.oldSettingName=n}else{const e=ue.settingName+"_01";ue.settingName=e,ue.oldSettingName=e}ke()}}))},Se=()=>{var e,i;if(!(null==(e=re.nowDeviceObj)?void 0:e.deviceId))return;ue.recevieData[se.wId]=e=>{ue.loading=!1;const i=null==e?void 0:e.result;ue.nowDeviceObj={...null==e?void 0:e.result},(null==i?void 0:i.name)&&(ue.settingName=null==i?void 0:i.name,ue.oldSettingName=null==i?void 0:i.name,ke())},ue.loading=!0,setTimeout((()=>{ue.loading=!1}),1e4);const t={type:"config/ak_device/device_id",id:se.wId++,device_id:re.nowDeviceObj.deviceId};null==(i=se.ws)||i.send(C(t))};return a((()=>le.show),(e=>{var i,t,a,l,n;e?(ue.deviceType="empty",ue.addNumber=1,ue.allDeviceList=[...null==oe?void 0:oe.devicesList],ue.choseRelayShow=!1,je(),ue.settingName=(null==(i=re.nowDeviceObj)?void 0:i.type_name)||"",Se(),ue.deviceObj=null==(a=null==(t=oe.devicesList)?void 0:t.find)?void 0:a.call(t,(e=>e.device_id===re.nowDeviceObj.deviceId)),Ne(),"Unknown"===(null==(l=ue.deviceObj)?void 0:l.product_type)&&"zigbee"===(null==(n=ue.deviceObj)?void 0:n.product_attributes)&&Oe()):re.cancelGetAkScan()})),a((()=>se.updataId),(e=>{S(ue.recevieData,e,se)}),{immediate:!0}),(e,i)=>{const t=b,a=h,f=w,D=_,N=y;return l(),n("div",x,[o(T,{show:ge.value,"onUpdate:show":i[3]||(i[3]=e=>ge.value=e),"class-name":"add-setting-dialog","foot-show":!1,"back-show":"Customize Remote Control"!==le.deviceType,title:le.replace?e.$t("Replace Device"):e.$t("Add device"),onButtonBack:pe,onButtonCancel:i[4]||(i[4]=e=>ie("update:show",!1))},{content:d((()=>{var b,h,w,_,y,O;return[s((l(),n("div",z,[c("div",B,[c("div",U,[c("img",{alt:"smart home,home automation,homekit,smart security,smart home systems,google home",src:r(L)(null==(b=r(re).nowDeviceObj)?void 0:b.activeWebp)},null,8,q)]),c("div",E,v(e.$t(r(I)(null==(h=r(re).nowDeviceObj)?void 0:h.type_name)))+" ",1)]),c("div",G,[c("div",null,v(e.$t("Device Name")),1),c("div",P,[o(t,{modelValue:ue.settingName,"onUpdate:modelValue":i[0]||(i[0]=e=>ue.settingName=e),maxlength:63,size:"large",placeholder:e.$t("Enter Device Name"),onBlur:fe},null,8,["modelValue","placeholder"])]),c("div",F,v(e.$t("Device Location")),1),c("div",M,[o(a,{modelValue:ue.settingLocation,"onUpdate:modelValue":i[1]||(i[1]=e=>ue.settingLocation=e),"popper-class":"setting-el-cas-cader",separator:"-",options:null==(_=null==(w=r(oe).newRoomList)?void 0:w.filter)?void 0:_.call(w,(e=>!("all"===e.area_id||"public"===e.area_id))),props:ve},null,8,["modelValue","options"])]),ue.choseRelayShow?(l(),n("section",W,[(l(!0),n(u,null,m(ue.moreSwitchDetail,((i,a,d)=>(l(),n("section",{key:d},["1 Gang Switch"!==me.value?(l(),n("div",H,v(e.$t("Switch"))+" "+v(d+1)+" "+v(e.$t("name")),1)):p("",!0),"1 Gang Switch"!==me.value?(l(),n("div",J,[o(t,{modelValue:i.entity_name,"onUpdate:modelValue":e=>i.entity_name=e,maxlength:50,size:"large",placeholder:e.$t("Enter Device Name"),onBlur:fe},null,8,["modelValue","onUpdate:modelValue","placeholder"])])):p("",!0)])))),128))])):p("",!0),"Unknown"===(null==(y=ue.deviceObj)?void 0:y.product_type)&&"zigbee"===(null==(O=ue.deviceObj)?void 0:O.product_attributes)?(l(),n("section",K,[c("div",Q,v(e.$t("Device Type")),1),c("div",X,[o(D,{modelValue:ue.deviceType,"onUpdate:modelValue":i[2]||(i[2]=e=>ue.deviceType=e),placeholder:e.$t("Select type"),class:"device-select-raly"},{default:d((()=>[(l(!0),n(u,null,m(ue.zigbeeTypeList,(i=>(l(),g(f,{key:i,label:e.$t(i),value:i},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])])):p("",!0)])])),[[N,ue.loading]]),c("div",Y,[c("div",Z,[o(R,{"akubela-test-value":`${r(re).nowDeviceObj.deviceId}`,"akubela-test":"device-add-finish","class-name":ue.settingName?"primary":"disabled","button-name":e.$t("End"),onClick:_e},null,8,["akubela-test-value","class-name","button-name"])])])]})),_:1},8,["show","back-show","title"]),o(T,{show:ue.isShowNameRe,"onUpdate:show":i[5]||(i[5]=e=>ue.isShowNameRe=e),class:"tip-dia-re","button-cancel-show":!0,"button-ok-name":e.$t("Confirm"),onButtonCancel:be,onButtonConfirm:he},{content:d((()=>[c("div",null,v(e.$t("The name already exists. Continue?")),1)])),_:1},8,["show","button-ok-name"])])}}};export{ee as _};
