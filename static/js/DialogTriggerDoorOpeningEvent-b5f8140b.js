import{j as e,h as o,u as s,w as r,N as a,a as l,S as t,s as c,b as i,n,m as d}from"./Akubela-login-home-part-Vendor-facddf88.js";import{b as m,j as u,w as p,b4 as h,b5 as b,q as k,bc as y,b7 as v,F as w,bl as f,ba as _,v as g,bb as A}from"./Akubela-element-plus-Vendor-47553b40.js";import"./Akubela-devices-img-Vendor-0f46fa2c.js";import"./Akubela-scenes-security-other-img-Vendor-2a1534ad.js";const D={class:"trigger-dia-door-opening-event"},C={class:"family-members-part"},E=["onClick"],j=v("span",{class:"common-row-triangle"},null,-1),B={class:"family-members-part-big"},O={class:"family-members-row-top"},S={class:"new-member-box"},U=["onClick"],$={class:"family-members-part-big"},P={class:"family-members-row-top"},V={key:0,class:"new-member-box"},x=["onClick"],F=["onClick"],I={key:1,class:"member-no-devices"},L={key:1,class:"member-no-devices"},q={__name:"DialogTriggerDoorOpeningEvent",props:{show:{type:Boolean,required:!0,default:!1},type:{type:String,default:"condition"}},emits:["update:show","open-dia-show","set-add-obj","pop-closed"],setup(q,{emit:K}){const N=q;let T=e();o();const{t:M}=s();let R=r();const z=m({acceptData:{},family_members:[],lockerDia:!1,pickeredArr:[],user_id:"",doorArray:[],sendData:{}}),G=u((()=>{let e={nfc:M("NFC Card Unlock"),rf_card:M("RF Card Unlock"),face:M("Face Unlock"),local_key:M("Local Key Unlock")};return"visitors"===z.user_id&&(e={call:M("Call Unlock"),temp_key:M("Temporary Key Unlock")}),"others"===z.user_id&&(e={inward_unlock:M("Door Opens Inward")}),e})),H=()=>{K("open-dia-show"),K("update:show",!1)},J=()=>{K("update:show",!0),z.lockerDia=!1},Q=()=>{K("update:show",!0),z.lockerDia=!1},W=()=>{K("update:show",!1),K("pop-closed")},X=()=>{var e;const o=[];z.doorArray.forEach((e=>{e.children.forEach((e=>{e.select&&o.push(e.mac)}))}));const s={platform:"door_phone_event",event_type:"open_door",event_data:{user_id:[z.user_id],open_door_type:z.pickeredArr,macs:o}};(null==(e=z.doorArray[0])?void 0:e.select)&&(s.event_data.macs=["all"]),K("set-add-obj",s),K("update:show",!1),z.lockerDia=!1},Y=()=>{const e=[];z.doorArray.forEach((o=>{o.children.forEach((o=>{e.push(o)}))}));const o=e.some((e=>e.select));return!z.pickeredArr.length||!o},Z=u({get:()=>N.show,set:e=>{K("update:show",e)}});return p((()=>R.updataId),(e=>{c(z.acceptData,e,R)}),{immediate:!0}),p((()=>N.show),(e=>{e&&(()=>{var e;z.acceptData[R.wId]=e=>{if(!e.success)return n(M("errorMessage"),"error");z.family_members=e.result.family_members,e.result.family_members.length&&z.family_members.push({user_id:"visitors",username:M("Visitors")}),z.family_members.push({user_id:"others",username:M("Anyone")})};const o={type:"ak_account/users/family_id",id:R.wId++,family_id:""};null==(e=R.ws)||e.send(d(o)),z.doorArray=[{id:"alldoor",name:M("Select All"),Select:!1,children:[]},{id:"publicdoor",name:M("Public Door"),Select:!1,children:T.newPublicDeviceList.filter((e=>e.is_pub)).map((e=>({...e,select:!1})))},{id:"privatedoor",name:M("Private Door"),Select:!1,children:T.newPublicDeviceList.filter((e=>!e.is_pub)).map((e=>({...e,select:!1})))}]})()})),p((()=>z.lockerDia),(e=>{e||(z.pickeredArr=[],z.user_id="")})),(e,o)=>{const s=i;return h(),b("div",D,[k(l,{show:Z.value,"onUpdate:show":o[0]||(o[0]=e=>Z.value=e),"back-show":!0,"foot-show":!1,title:e.$t("Door Opening Event"),class:"akubela-test-trigger-dia-door-opening-event",onButtonCancel:W,onButtonBack:H},{content:y((()=>[v("div",C,[(h(!0),b(w,null,f(z.family_members,(e=>(h(),b("div",{key:e.user_id,class:"family-members-row",onClick:o=>(e=>{z.user_id=e.user_id,K("update:show",!1),z.lockerDia=!0})(e)},[v("span",null,_(g(a)(e)),1),j],8,E)))),128))])])),_:1},8,["show","title"]),k(l,{show:z.lockerDia,"onUpdate:show":o[1]||(o[1]=e=>z.lockerDia=e),"back-show":!0,"is-ash":Y(),title:e.$t("Door Opening Event"),onButtonCancel:Q,onButtonBack:J,onButtonConfirm:X},{content:y((()=>[v("div",B,[v("div",O,[v("span",null,_(e.$t("Select Door Opening Option")),1)]),v("div",S,[(h(!0),b(w,null,f(G.value,((e,o,r)=>(h(),b("div",{key:o,class:A(["family-members-row-new",Object.keys(G.value).length-1!==r?"padding-bottom-border":""]),onClick:e=>(e=>{z.pickeredArr.includes(e)?((e,o)=>{const s=e.indexOf(o);s>-1&&e.splice(s,1)})(z.pickeredArr,e):z.pickeredArr.push(e)})(o)},[v("span",null,_(e),1),k(s,{"icon-class":z.pickeredArr.includes(o)?"tick_active":""},null,8,["icon-class"])],10,U)))),128))])]),v("div",$,[v("div",P,[v("span",null,_(e.$t("Select door opening device")),1)]),g(T).newPublicDeviceList.length?(h(),b("div",V,[(h(!0),b(w,null,f(z.doorArray,((o,r)=>(h(),b("div",{key:r,class:A(r!==z.doorArray.length-1?"padding-bottom-border":"")},[v("div",{class:A(["family-members-row-new","alldoor"!==o.id?"padding-bottom-border":""]),onClick:e=>(e=>{e.select=!e.select,e.children.forEach((o=>{o.select=e.select})),"alldoor"===e.id&&z.doorArray.forEach((o=>{o.select=e.select,o.children.forEach((o=>o.select=e.select))})),e.select||(z.doorArray[0].select=!1);const o=z.doorArray[1],s=z.doorArray[2];(null==o?void 0:o.select)&&(null==s?void 0:s.select)&&(z.doorArray[0].select=!0)})(o)},[v("span",null,_(o.name),1),k(s,{"icon-class":o.select?"tick_active":""},null,8,["icon-class"])],10,x),o.children.length||"alldoor"===o.id?(h(!0),b(w,{key:0},f(o.children,(e=>(h(),b("div",{key:e.mac,class:"row-door-row",onClick:s=>((e,o)=>{e.select=!e.select,o.select=o.children.every((e=>e.select));const s=z.doorArray[1],r=z.doorArray[2];z.doorArray[0].select=(null==s?void 0:s.select)&&(null==r?void 0:r.select)})(e,o)},[k(t,{content:e.name},null,8,["content"]),k(s,{"icon-class":e.select?"tick_active":""},null,8,["icon-class"])],8,F)))),128)):(h(),b("div",I,_(e.$t("no devices")),1))],2)))),128))])):(h(),b("div",L,_(e.$t("no devices")),1))])])),_:1},8,["show","is-ash","title"])])}}};export{q as default};
