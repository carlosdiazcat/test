import{b as e,j as t,w as l,bd as i,b4 as a,be as r,bc as s,b5 as d,F as o,bl as n,b7 as u,ba as c,q as p,v,b9 as _,bf as y,bw as g,bx as w,bn as m,bh as f}from"./Akubela-element-plus-Vendor-47553b40.js";import{j as h,e as b,u as k,w as j,s as D,a as O,n as V,m as T,al as L}from"./Akubela-login-home-part-Vendor-facddf88.js";import{e as I}from"./config-178dd060.js";import"./Akubela-devices-img-Vendor-0f46fa2c.js";import"./Akubela-scenes-security-other-img-Vendor-2a1534ad.js";const $={key:0,class:"content-part"},A={class:"setting-relay-row"},x={class:"device-default-row-left"},C={class:"device-row-left-text"},z={class:"device-default-row-right"},B={key:0,class:"setting-relay-row"},H={class:"device-default-row-left"},M={class:"device-row-left-text"},U={class:"device-default-row-right"},S={key:0,class:"show-tip"},P={key:1,class:"show-tip"},N={key:1,class:"setting-relay-row"},q={class:"device-default-row-left"},R={class:"device-row-left-text"},F={class:"device-default-row-right"},E={key:0,class:"show-tip"},G={key:1,class:"show-tip"},J={key:0,class:"setting-relay-row"},K={class:"device-default-row-left"},Q={class:"device-row-left-text"},W={class:"device-default-row-right"},X={key:1,class:"no-data-part"},Y={__name:"DeviceDialogRelaySetting",props:{show:{type:Boolean,required:!0,default:!1}},emits:["update:show","get-list"],setup(Y,{emit:Z}){const ee=Y,te=h();let le=b();const{deviceCardObj:ie}=te,{t:ae}=k(),re=e({acceptData:{},relayTypeList:[],loading:!1,upOrLow:[],temperaturSourceList:[],listen_temperature_device_id:"",errObj:{heat_upper:!1,heat_lower:!1,cooling_upper:!1,cooling_lower:!1}}),se=t((()=>ie.deviceDetail.attributes.find((e=>"online"===e.domain)))),de=j(),oe=()=>{Z("update:show",!1)},ne=()=>re.relayTypeList.find((e=>"Heating"===e.type||"Cooling"===e.type)),ue=t({get:()=>ee.show,set:e=>{Z("update:show",e)}}),ce=()=>{var e,t;re.acceptData[de.wId]=e=>{var t;if(re.loading=!1,!(null==e?void 0:e.success))return V(ae("errorMessage"),"error");Array.isArray(null==e?void 0:e.result)&&(null==(t=null==e?void 0:e.result)?void 0:t.length)&&(re.upOrLow=e.result)},re.loading=!0,setTimeout((()=>{re.loading=!1}),15e3);const l={type:"config/ak_device/get_hysteresis_temperature",id:de.wId++,device_id:null==(e=ie.deviceDetail)?void 0:e.device_id};null==(t=de.ws)||t.send(T(l))},pe=(e,t,l)=>{var i;const a=((e,t,l)=>{const i="01"===l||"02"===l||"03"===l||"04"===l||"05"===l||"0."===l||"1."===l||"2."===l||"3."===l||"4."===l||"5."===l,a=+l,r=l.length>3||""===l||i||isNaN(a)||!L.regNum0To5.test(a);return"Heating"===t?"upper"===e?r?(re.errObj.heat_upper=!0,!0):(re.errObj.heat_upper=!1,!1):r?(re.errObj.heat_lower=!0,!0):(re.errObj.heat_lower=!1,!1):"upper"===e?r?(re.errObj.cooling_upper=!0,!0):(re.errObj.cooling_upper=!1,!1):r?(re.errObj.cooling_lower=!0,!0):(re.errObj.cooling_lower=!1,!1)})(e,t,l);if(a)return;re.acceptData[de.wId]=e=>{if(re.loading=!1,!(null==e?void 0:e.success))return V(ae("errorMessage"),"error");V(ae("successfully"),"success")};const r=le.findAbility(ie.deviceDetail,"climate","listen_temperature_device_id");re.loading=!0,setTimeout((()=>{re.loading=!1}),15e3);const s={type:"config/ak_device/set_hysteresis_temperature",id:de.wId++,entity_id:null==r?void 0:r.entity_id},d=+l;"Heating"===t?"upper"===e?s.heat_upper=d:s.heat_lower=d:"upper"===e?s.cool_upper=d:s.cool_lower=d,null==(i=de.ws)||i.send(T(s))},ve=()=>{var e;re.acceptData[de.wId]=e=>{if(re.loading=!1,!e.success)return V(ae("errorMessage"),"error");re.temperaturSourceList=(null==e?void 0:e.result)||[];const t=le.findAbility(ie.deviceDetail,"climate","listen_temperature_device_id");var l;l=t.value,re.temperaturSourceList.find((e=>l===e.device_id))?re.listen_temperature_device_id=t.value:re.listen_temperature_device_id=""},re.loading=!0,setTimeout((()=>{re.loading=!1}),15e3);const t={type:"config/ak_device/temperature_list",id:de.wId++};null==(e=de.ws)||e.send(T(t))},_e=()=>{var e,t;re.acceptData[de.wId]=e=>{if(re.loading=!1,!e.success)return V(ae("errorMessage"),"error");V(ae("successfully"),"success")};const l=le.findAbility(ie.deviceDetail,"climate","listen_temperature_device_id");re.loading=!0,setTimeout((()=>{re.loading=!1}),15e3);const i={type:"config/ak_device/update_relay_climate",device_id:null==(e=ie.deviceDetail)?void 0:e.device_id,entity_id:null==l?void 0:l.entity_id,listen_temperature_device_id:re.listen_temperature_device_id,id:de.wId++};null==(t=de.ws)||t.send(T(i))};return l((()=>de.updataId),(e=>{D(re.acceptData,e,de)}),{immediate:!0}),l((()=>ee.show),(e=>{e?(()=>{var e,t;re.acceptData[de.wId]=e=>{var t,l,i;if(re.loading=!1,!(null==e?void 0:e.success))return V(ae("errorMessage"),"error");Array.isArray(null==e?void 0:e.result)&&(null==(t=null==e?void 0:e.result)?void 0:t.length)&&(re.relayTypeList=null==(i=null==(l=e.result)?void 0:l.sort)?void 0:i.call(l,((e,t)=>e.index-t.index)),ne()&&(ve(),ce()))},re.loading=!0,setTimeout((()=>{re.loading=!1}),15e3);const l={type:"config/ak_device/relay_type_list",id:de.wId++,device_id:null==(e=ie.deviceDetail)?void 0:e.device_id};null==(t=de.ws)||t.send(T(l))})():re.errObj={heat_upper:!1,heat_lower:!1,cooling_upper:!1,cooling_lower:!1}})),(e,t)=>{const l=g,h=w,b=m,k=f;return i((a(),r(O,{show:ue.value,"onUpdate:show":t[1]||(t[1]=e=>ue.value=e),"foot-show":!1,"back-show":!0,class:"dia-relay-setting",title:e.$t("Relay Setting"),onButtonBack:oe,onButtonCancel:t[2]||(t[2]=e=>Z("update:show",!1))},{content:s((()=>[re.relayTypeList.length?(a(),d("div",$,[(a(!0),d(o,null,n(re.relayTypeList,((t,i)=>(a(),d("div",{key:t.device_id,class:"device-detail-setting-row"},[u("div",A,[u("div",x,[u("div",C,c(e.$t("Device Type"))+c(re.relayTypeList.length>1?i+1:""),1)]),u("div",z,[p(h,{"model-value":e.$t(t.type),size:v(I),disabled:!se.value.value,class:"device-select-raly",onChange:e=>((e,t)=>{var l,i;re.acceptData[de.wId]=e=>{var t;if(re.loading=!1,!e.success)return V(ae(null==(t=null==e?void 0:e.error)?void 0:t.code),"error");oe(),te.deviceCurrent.dialogVisible=!1,V(ae("The type is changed successfully."),"success")},re.loading=!0,setTimeout((()=>{re.loading=!1}),15e3);const a={type:"config/ak_device/update_switch_type",device_id:null==(l=ie.deviceDetail)?void 0:l.device_id,product_type:e,id:de.wId++,index:t.index};null==(i=de.ws)||i.send(T(a))})(e,t)},{default:s((()=>[(a(!0),d(o,null,n(t.type_list,(t=>(a(),r(l,{key:t,label:e.$t(t),value:t},null,8,["label","value"])))),128))])),_:2},1032,["model-value","size","disabled","onChange"])])]),(a(!0),d(o,null,n(re.upOrLow,(l=>(a(),d("div",{key:l.type},[ne()&&t.type===l.type?(a(),d("div",B,[u("div",H,[u("div",M,c(e.$t("Upper Hysteresis Value")),1)]),u("div",U,[p(b,{modelValue:l.upper,"onUpdate:modelValue":e=>l.upper=e,modelModifiers:{trim:!0},size:v(I),placeholder:"0-5",onBlur:e=>pe("upper",l.type,l.upper)},{append:s((()=>[_("℃")])),_:2},1032,["modelValue","onUpdate:modelValue","size","onBlur"]),re.errObj.heat_upper&&"Heating"===l.type?(a(),d("div",S,c(e.$t("Please enter a valid number.")),1)):y("",!0),re.errObj.cooling_upper&&"Cooling"===l.type?(a(),d("div",P,c(e.$t("Please enter a valid number.")),1)):y("",!0)])])):y("",!0),ne()&&t.type===l.type?(a(),d("div",N,[u("div",q,[u("div",R,c(e.$t("Lower Hysteresis Value")),1)]),u("div",F,[p(b,{modelValue:l.lower,"onUpdate:modelValue":e=>l.lower=e,modelModifiers:{trim:!0},size:v(I),placeholder:"0-5",onBlur:e=>pe("lower",l.type,l.lower)},{append:s((()=>[_("℃")])),_:2},1032,["modelValue","onUpdate:modelValue","size","onBlur"]),re.errObj.heat_lower&&"Heating"===l.type?(a(),d("div",E,c(e.$t("Please enter a valid number.")),1)):y("",!0),re.errObj.cooling_lower&&"Cooling"===l.type?(a(),d("div",G,c(e.$t("Please enter a valid number.")),1)):y("",!0)])])):y("",!0)])))),128))])))),128)),ne()?(a(),d("div",J,[u("div",K,[u("div",Q,c(e.$t("Temperature source")),1)]),u("div",W,[p(h,{modelValue:re.listen_temperature_device_id,"onUpdate:modelValue":t[0]||(t[0]=e=>re.listen_temperature_device_id=e),size:v(I),placeholder:e.$t("Please enter"),onChange:_e},{default:s((()=>[(a(!0),d(o,null,n(re.temperaturSourceList,((e,t)=>(a(),r(l,{key:t,label:e.name,value:e.device_id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","size","placeholder"])])])):y("",!0)])):(a(),d("div",X))])),_:1},8,["show","title"])),[[k,re.loading]])}}};export{Y as default};
