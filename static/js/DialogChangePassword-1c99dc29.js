import{r as e,b as s,w as a,p as o,b4 as t,b5 as r,q as n,bc as l,b7 as d,ba as i,bs as u,bn as w,bA as c,bB as m}from"./Akubela-element-plus-Vendor-47553b40.js";import{j as f,u as h,w as p,a as b,l as P,bc as g,n as v,M as _,s as V,m as x}from"./Akubela-login-home-part-Vendor-facddf88.js";import"./Akubela-devices-img-Vendor-0f46fa2c.js";import"./Akubela-scenes-security-other-img-Vendor-2a1534ad.js";const T={class:"setting-change-code"},S={class:"setting-change-box"},$={class:"setting__input-content"},k={class:"setting-change-box"},y={class:"setting-change-show"},L={__name:"DialogChangePassword",props:{show:{type:Boolean,required:!0,default:!1}},emits:["update:show"],setup(L,{emit:j}){const D=L;let I=f();const{t:U}=h();let A=p();const C=e(),B=s({recevieData:{},diaShow:!1,form:{username:"admin",currentPassword:"",newPassword:"",confimPassword:"",sendText:""},defaultShow:!0,familyList:[],rules:{currentPassword:[{validator:(e,s,a)=>{var o;return((null==(o=P.getItem("loginPassWord"))?void 0:o.value)||"")!==s?a(U("Incorrect current password.")):a()},"validate-event":!1}],newPassword:[{validator:(e,s,a)=>s.length<8?a(U("The password must contain both numbers and letters, with a length of 8 to 64 characters.")):g(s)?a():a(U("The password must contain both numbers and letters, with a length of 8 to 64 characters."))}]},offLineDevices:[],offLineText:"",titShow:!1,dialogObj:{"close-on-click-modal":!1,"close-on-press-escape":!1}}),O=()=>{C.value.validate((async e=>{if(e){if(!M())return;q[B.form.username]()}}))},M=()=>{let e=!0;const{form:s}=B;return s.newPassword!==s.confimPassword?(e=!1,v(U("Password not match!"),"error")):s.currentPassword===s.newPassword?(e=!1,v(U("New password and current password are the same!"),"error")):e},N=()=>{const e=I.devicesList.filter((e=>"panel"===e.product_attributes&&!e.online));e.length?(B.offLineText="",B.offLineDevices=e,e.forEach((e=>{B.offLineText=B.offLineText+e.name+","})),B.offLineText=B.offLineText.slice(0,-1),B.titShow=!0,j("update:show",!1)):(_.emit("logutOut"),j("update:show",!1))},W=e=>{if(!e.success)return v(U("errorMessage"),"error");P.set("loginPassWord",B.form.newPassword),N()},q={admin:()=>{var e;const{form:s}=B;B.recevieData[A.wId]=e=>{if(!e.success)return v(U("errorMessage"),"error");P.set("loginPassWord",s.newPassword),N()};const a={id:A.wId++,type:"ak_account/project_user/update_pwd",username:s.username,cur_pwd:s.currentPassword,new_pwd:s.newPassword};null==(e=A.ws)||e.send(x(a))},Admin888:()=>{var e;const{form:s}=B;B.recevieData[A.wId]=W;const a={id:A.wId++,current_password:P.getItem("loginPassword").value,new_password:s.newPassword,type:"config/auth_provider/homeassistant/change_password"};null==(e=A.ws)||e.send(x(a))}};a((()=>D.show),(e=>{B.diaShow=e,e&&(B.form={username:P.getItem("loginName").value,currentPassword:"",newPassword:"",confimPassword:"",sendText:""})}),{immediate:!0});const E=()=>{B.titShow=!1,_.emit("logutOut")},F=()=>{j("update:show",!1)};return a((()=>A.updataId),(e=>{V(B.recevieData,e,A)}),{immediate:!0}),o((()=>{C.value=null,B.recevieData=null})),(e,s)=>{const a=w,o=c,f=m;return t(),r("div",T,[n(b,{show:B.diaShow,"onUpdate:show":s[5]||(s[5]=e=>B.diaShow=e),"button-ok-name":e.$t("Submit"),"is-ash":!B.form.currentPassword||!B.form.newPassword||!B.form.confimPassword,onButtonCancel:F,onButtonConfirm:O},{content:l((()=>[d("div",S,[d("div",null,i(e.$t("The password must contain both numbers and letters, with a length of 8 to 64 characters.")),1),d("div",$,[n(f,{ref_key:"ruleFormRef",ref:C,"label-position":"right","label-width":"auto",model:B.form,rules:B.rules,onSubmit:s[4]||(s[4]=u((()=>{}),["prevent"]))},{default:l((()=>[n(o,{prop:"username",label:e.$t("Username")},{default:l((()=>[n(a,{modelValue:B.form.username,"onUpdate:modelValue":s[0]||(s[0]=e=>B.form.username=e),disabled:"",placeholder:e.$t("Please enter")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),n(o,{prop:"currentPassword",label:e.$t("Current Password")},{default:l((()=>[n(a,{modelValue:B.form.currentPassword,"onUpdate:modelValue":s[1]||(s[1]=e=>B.form.currentPassword=e),type:"password","show-password":"","validate-event":!1,placeholder:e.$t("Please enter")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),n(o,{prop:"newPassword",label:e.$t("New Password")},{default:l((()=>[n(a,{modelValue:B.form.newPassword,"onUpdate:modelValue":s[2]||(s[2]=e=>B.form.newPassword=e),type:"password","show-password":"","validate-event":!1,placeholder:e.$t("Please enter"),maxlength:"64"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),n(o,{prop:"confimPassword",label:e.$t("Confirm Password")},{default:l((()=>[n(a,{modelValue:B.form.confimPassword,"onUpdate:modelValue":s[3]||(s[3]=e=>B.form.confimPassword=e),type:"password","show-password":"","validate-event":!1,placeholder:e.$t("Please enter"),maxlength:"64"},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model","rules"])])])])),_:1},8,["show","button-ok-name","is-ash"]),n(b,{show:B.titShow,"onUpdate:show":s[6]||(s[6]=e=>B.titShow=e),"button-ok-name":e.$t("Done"),"dialog-obj":B.dialogObj,onButtonConfirm:E},{content:l((()=>[d("div",k,[d("div",null,i(e.$t("The following devices are offline. Password changes will sync when online.")),1),d("div",y,i(B.offLineText),1)])])),_:1},8,["show","button-ok-name","dialog-obj"])])}}};export{L as default};
