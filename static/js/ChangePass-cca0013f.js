import{r as e,b as s,w as a,p as o,b4 as t,b5 as n,q as r,bc as l,b7 as d,ba as i,bs as u,be as m,bf as c,bn as w,bA as p,bB as f}from"./Akubela-element-plus-Vendor-47553b40.js";import{j as h,u as b,w as g,l as P,s as v,P as _,a as k,bc as y,n as $,M as V,m as S}from"./Akubela-login-home-part-Vendor-facddf88.js";import"./Akubela-devices-img-Vendor-0f46fa2c.js";import"./Akubela-scenes-security-other-img-Vendor-2a1534ad.js";const j={class:"setting-change-code"},x={class:"setting-change-box"},I={class:"setting__input-content"},C={class:"setting-bottom__box"},A={class:"setting-change-box"},D={class:"setting-change-show"},T={__name:"ChangePass",props:{show:{type:Boolean,required:!0,default:!1}},emits:["update:show"],setup(T,{emit:U}){const O=T;h();const{t:B}=b();let L=g();const M=e(),q=s({recevieData:{},diaShow:!1,form:{username:"admin",currentPassword:"",newPassword:"",confimPassword:"",sendText:""},defaultShow:!0,familyList:[],rules:{newPassword:[{validator:(e,s,a)=>s.length<8?a(B("The password must contain both numbers and letters, with a length of 8 to 64 characters.")):y(s)?a():a(B("The password must contain both numbers and letters, with a length of 8 to 64 characters."))}]},offLineDevices:[],offLineText:"",titShow:!1,dialogObj:{"close-on-click-modal":!1,"close-on-press-escape":!1}}),N=()=>{R()||M.value.validate((async e=>{if(e){if(!W())return;F[q.form.username]()}}))},W=()=>{let e=!0;const{form:s}=q;return s.newPassword!==s.confimPassword?(e=!1,$(B("Password not match!"),"error")):s.currentPassword===s.newPassword?(e=!1,$(B("New password and current password are the same!"),"error")):e},G=e=>{if(!e.success)return $(B("errorMessage"),"error");P.set("loginPassWord",q.form.newPassword),U("update:show",!1),V.emit("logutOut")},F={admin:()=>{var e,s;const{form:a}=q;q.recevieData[L.wId]=e=>{if(!e.success)return $(B("errorMessage"),"error");P.set("loginPassWord",a.newPassword),U("update:show",!1),V.emit("logutOut")};const o={id:L.wId++,type:"ak_account/project_user/update_pwd",username:a.username,cur_pwd:(null==(e=P.getItem("loginPassWord"))?void 0:e.value)||"",new_pwd:a.newPassword};null==(s=L.ws)||s.send(S(o))},Admin888:()=>{var e;const{form:s}=q;q.recevieData[L.wId]=G;const a={id:L.wId++,current_password:P.getItem("loginPassword").value,new_password:s.newPassword,type:"config/auth_provider/homeassistant/change_password"};null==(e=L.ws)||e.send(S(a))}},R=()=>!q.form.newPassword||!q.form.confimPassword,Y=()=>{V.emit("logutOut")};a((()=>O.show),(e=>{q.diaShow=e,e&&(q.form={username:P.getItem("loginName").value,currentPassword:"",newPassword:"",confimPassword:"",sendText:""})}),{immediate:!0});const z=()=>{q.titShow=!1},E=()=>{U("update:show",!1)};a((()=>L.updataId),(e=>{v(q.recevieData,e,L)}),{immediate:!0});const H=()=>{var e;if("Admin888"===q.form.username)return U("update:show",!1);q.recevieData[L.wId]=e=>{if(!e.success)return $(B("errorMessage"),"error");U("update:show",!1)};const s={id:L.wId++,type:"ak_account/project_user/ignore",username:q.form.username,ignore:!0};null==(e=L.ws)||e.send(S(s))};return o((()=>{M.value=null,q.recevieData=null})),(e,s)=>{const a=w,o=p,h=f;return t(),n("div",j,[r(k,{show:q.diaShow,"onUpdate:show":s[4]||(s[4]=e=>q.diaShow=e),title:e.$t("You are requested to change the default password for security reason."),"button-ok-name":e.$t("Submit"),"foot-show":!1,"dialog-obj":q.dialogObj,onButtonCancel:E},{content:l((()=>[d("div",x,[d("div",null,i(e.$t("The password must contain both numbers and letters, with a length of 8 to 64 characters.")),1),d("div",I,[r(h,{ref_key:"ruleFormRef",ref:M,"label-position":"left","label-width":"auto",model:q.form,rules:q.rules,onSubmit:s[3]||(s[3]=u((()=>{}),["prevent"]))},{default:l((()=>[r(o,{prop:"username",label:e.$t("Username")},{default:l((()=>[r(a,{modelValue:q.form.username,"onUpdate:modelValue":s[0]||(s[0]=e=>q.form.username=e),disabled:"",placeholder:e.$t("Please enter")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),r(o,{prop:"newPassword",label:e.$t("New Password")},{default:l((()=>[r(a,{modelValue:q.form.newPassword,"onUpdate:modelValue":s[1]||(s[1]=e=>q.form.newPassword=e),type:"password","show-password":"","validate-event":!1,placeholder:e.$t("Please enter"),maxlength:"64"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),r(o,{prop:"confimPassword",label:e.$t("Confirm Password")},{default:l((()=>[r(a,{modelValue:q.form.confimPassword,"onUpdate:modelValue":s[2]||(s[2]=e=>q.form.confimPassword=e),type:"password","show-password":"","validate-event":!1,placeholder:e.$t("Please enter"),maxlength:"64"},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1},8,["model","rules"])]),d("div",C,["admin"===q.form.username?(t(),m(_,{key:0,class:"bottom-buttons__cancel","class-name":"transparentGray","button-name":e.$t("exit"),onClick:u(Y,["stop"])},null,8,["button-name","onClick"])):c("",!0),"Admin888"===q.form.username?(t(),m(_,{key:1,class:"bottom-buttons__cancel","class-name":"transparentGray","button-name":e.$t("Ignore"),onClick:u(H,["stop"])},null,8,["button-name","onClick"])):c("",!0),r(_,{class:"bottom-buttons__cancel","class-name":R()?"disabled":"primary","button-name":e.$t("Submit"),onClick:u(N,["stop"])},null,8,["class-name","button-name","onClick"])])])])),_:1},8,["show","title","button-ok-name","dialog-obj"]),r(k,{show:q.titShow,"onUpdate:show":s[5]||(s[5]=e=>q.titShow=e),"button-ok-name":e.$t("Done"),onButtonConfirm:z},{content:l((()=>[d("div",A,[d("div",null,i(e.$t("The following devices are offline. Password changes will sync when online.")),1),d("div",D,i(q.offLineText),1)])])),_:1},8,["show","button-ok-name"])])}}};export{T as default};
