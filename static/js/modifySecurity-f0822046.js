import{b as e,l,j as a,w as t,b4 as s,b5 as o,q as i,bc as d,b7 as n,v as r,bV as c,F as m,bl as u,ba as v,bb as f,bn as y,r as h,p,bA as _,bz as w,bw as g,bx as b,bB as k,bh as S,be as C,bf as V,bd as L}from"./Akubela-element-plus-Vendor-47553b40.js";import{j as D,u as $,w as U,m as A,n as P,g as T,am as O,a as E,s as I,a4 as H,S as M,P as N,aO as j,b as x}from"./Akubela-login-home-part-Vendor-facddf88.js";import"./Akubela-devices-img-Vendor-0f46fa2c.js";import"./Akubela-scenes-security-other-img-Vendor-2a1534ad.js";const B={class:"dia-any-device"},z={class:"dia-any-search"},F={class:"dia-search-left"},R={class:"dia-search-all"},q=["src"],J={class:"dia-devices-list"},G=["onClick"],K={class:"dia-row-left"},Q={class:"devices-content-detail"},W={class:"devices-content-name"},X={class:"devices-content-local"},Y={class:"dia-row-right"},Z={__name:"DiaAnyDevice",props:{show:{type:Boolean,required:!0,default:!1},deviceSelected:{type:Array,default:()=>[]}},emits:["update:show","update:deviceSelected"],setup(h,{emit:p}){const _=h;let w=D();const{t:g}=$();let b=U();const k=e({recevieData:{},searchName:"",devicesList:[]});l((()=>{S()}));const S=()=>{var e;k.recevieData[b.wId]=C;const l={type:"config/ak_device/security_trigger_list",id:b.wId++};null==(e=b.ws)||e.send(A(l))},C=e=>{var l,a;if(!e.success)return P(g("Unknown error"),"error");k.devicesList=null==(a=null==(l=e.result)?void 0:l.map)?void 0:a.call(l,(e=>{var l,a;if(!e.product_type){const t=null==(a=null==(l=w.devicesList)?void 0:l.find)?void 0:a.call(l,(l=>l.device_id===e.device_id));e.product_type=t.product_type}return{...e}}));const t=[];_.deviceSelected.forEach((e=>{var l;null==(l=null==t?void 0:t.push)||l.call(t,e.entity_id)})),k.devicesList.forEach((e=>{t.includes(e.entity_id)?e.selected=!0:e.selected=!1}))},V=()=>{var e,l,a,t;H.value?null==(l=null==(e=k.devicesList)?void 0:e.filter)||l.call(e,(e=>e.name.includes(k.searchName))).forEach((e=>{e.selected=!1})):null==(t=null==(a=k.devicesList)?void 0:a.filter)||t.call(a,(e=>e.name.includes(k.searchName))).forEach((e=>{e.selected=!0}))},L=()=>{var e,l;const a=null==(l=null==(e=k.devicesList)?void 0:e.filter)?void 0:l.call(e,(e=>e.selected));p("update:deviceSelected",a),p("update:show",!1)},H=a((()=>{var e,l;return null==(l=null==(e=k.devicesList)?void 0:e.filter)?void 0:l.call(e,(e=>e.name.includes(k.searchName))).every((e=>e.selected))})),M=a({get:()=>_.show,set:e=>{p("update:show",e)}});return t((()=>b.updataId),(e=>{I(k.recevieData,e,b)}),{immediate:!0}),(e,l)=>{const a=y;return s(),o("div",B,[i(E,{show:M.value,"onUpdate:show":l[1]||(l[1]=e=>M.value=e),title:e.$t("Any Device Activated"),onButtonCancel:l[2]||(l[2]=e=>p("update:show",!1)),onButtonConfirm:L},{content:d((()=>{var t,d;return[n("div",z,[n("div",F,[i(a,{modelValue:k.searchName,"onUpdate:modelValue":l[0]||(l[0]=e=>k.searchName=e),"prefix-icon":r(c)},null,8,["modelValue","prefix-icon"])]),n("div",R,[n("img",{alt:"smart home,home automation,homekit,smart security,smart home systems,google home",src:H.value?r(T)("security/deselect_all_selected.webp"):r(T)("security/deselect_all.webp"),onClick:V},null,8,q)])]),n("div",J,[(s(!0),o(m,null,u(null==(d=null==(t=k.devicesList)?void 0:t.filter)?void 0:d.call(t,(e=>e.name.includes(k.searchName))),(l=>(s(),o("div",{key:l.entity_id,class:"dia-devices-row",onClick:e=>(e=>{e.selected=!e.selected})(l)},[n("div",K,[i(O,{class:"devices-list-avatar","card-obj":l,online:!0},null,8,["card-obj"]),n("div",Q,[n("div",W,v(l.name),1),n("div",X,v(l.room||e.$t("Other")),1)])]),n("div",Y,[n("span",{class:f([l.selected?"modify-more-right-active":" ","modify-more-right"])},null,2)])],8,G)))),128))])]})),_:1},8,["show","title"])])}}},ee={class:"scenes-security-modify"},le={class:"security-modify__title"},ae={class:"security-modify__title-left"},te={class:"security-modify__title-font"},se={class:"security-modify-content"},oe={class:"security-modify-form"},ie={class:"security-modify__head"},de={class:"security-modify__head__img"},ne=["src"],re={key:1,class:"modify-name-basic"},ce={class:"security-modify-devices"},me={class:"modify-devices__title"},ue={class:"modify-devices-content"},ve={class:"devices-content__left"},fe={class:"devices-content-detail"},ye={class:"devices-content-name"},he={class:"devices-content-local"},pe=["onClick"],_e={class:"modify-devices-add"},we={class:"security-modify-task"},ge={class:"modify-task__title"},be={class:"modify-task-content"},ke={class:"modify-task-check"},Se={key:0,class:"modify-task-name__textarea"},Ce={key:1,class:"modify-task-name"},Ve={class:"modify-task-selected"},Le={class:"modify-selected-title"},De={class:"modify-selected-more"},$e={class:"modify-more-left"},Ue=n("span",{class:"modify-more-right"},null,-1),Ae={class:"modify-task-selected"},Pe={class:"modify-selected-title"},Te={class:"modify-selected-more"},Oe={class:"modify-more-left"},Ee=n("span",{class:"modify-more-right"},null,-1),Ie={class:"modify-task-selected"},He={class:"modify-selected-title"},Me={class:"modify-task-selected"},Ne={class:"modify-selected-title"},je={class:"modify__button-row"},xe={__name:"modifySecurity",setup(a){const c=H();let B=U();const{t:z}=$(),F=h();let R=D();const q=e({recevieData:{},id:"",type:"",securityAllList:[],oldFormStr:"",secondConfirm:!1,buttonOkLoading:!1,form:{name:"",activitedDevice:[],type:"custom",defenceDelay:0,isSilentOn:!1,isSirenOn:!1,isSendMessage:!1,messageContent:"",isSendHttpCommand:!1,httpCommand:"",relay:[],isArm:!1,alarmDelay:0,callList:[]},relayList:[],callList:[],deviceShow:!1,basicShow:!1,deleteShow:!1}),J=e({name:[{validator:(e,l,a)=>{var t,s,o,i;j(l)||a(new Error(z("Please enter a name no longer than 63 characters."))),0===l.length&&a(new Error(z("Please enter a name no longer than 63 characters."))),"add"===q.type&&(null==(s=null==(t=q.securityAllList)?void 0:t.some)?void 0:s.call(t,(e=>e.name===l)))&&a(new Error(z("The security name already exists."))),"edit"===q.type&&(null==(i=null==(o=q.securityAllList)?void 0:o.filter)||i.call(o,(e=>e.id!==q.id)).forEach((e=>{e.name===l&&a(new Error(z("The security name already exists.")))}))),a()},trigger:["blur","change"]}],messageContent:[{validator:(e,l,a)=>{q.form.isSendMessage&&0===l.length&&a(new Error(z("Please enter a name no longer than 256 characters."))),q.form.isSendMessage&&l.length>256?a(new Error(z("Please enter a name no longer than 256 characters."))):a()},trigger:["blur","change"]}],httpCommand:[{validator:(e,l,a)=>{q.form.isSendHttpCommand&&0===l.length&&a(new Error(z("Please enter a name no longer than 265 characters."))),l.length>265&&a(new Error(z("Please enter a name no longer than 265 characters.")));const t=l.substring(0,7),s=l.substring(0,8);7===l.length&&"http://"===t&&a(new Error(z("Please enter a valid HTTP or HTTPS command"))),8===l.length&&"https://"===s&&a(new Error(z("Please enter a valid HTTP or HTTPS command"))),"http://"===t||"https://"===s?a():a(new Error(z("Please enter a valid HTTP or HTTPS command")))},trigger:["blur","change"]}]}),G=[{value:0,label:"0s"},{value:30,label:"30s"},{value:60,label:"60s"},{value:90,label:"90s"}];l((()=>{K()}));const K=()=>{var e,l;X(),xe();const a=null==(l=null==(e=c.currentRoute.value)?void 0:e.query)?void 0:l.id;a?(q.id=a,q.type="edit",Q()):(q.type="add",Q())},Q=()=>{var e;q.recevieData[B.wId]=W;const l={type:"config/ak_security/list",id:B.wId++};null==(e=B.ws)||e.send(A(l))},W=e=>{if(!e.success)return P(z("Unknown error"),"error");q.securityAllList=e.result,e.result.forEach((e=>{var l,a;e.id===q.id&&(q.form=e,q.form.callList=null==(a=null==(l=q.form.callList)?void 0:l.map)?void 0:a.call(l,(e=>e.toLowerCase())),q.oldFormStr=JSON.stringify(e))})),"Home"!==q.form.name&&"Night"!==q.form.name&&"Away"!==q.form.name||(q.basicShow=!0),"add"===q.type&&(q.oldFormStr=JSON.stringify(q.form))},X=()=>{var e;q.recevieData[B.wId]=Y;const l={type:"config/ak_device/security_relay_list",id:B.wId++};null==(e=B.ws)||e.send(A(l))},Y=e=>{if(!e.success)return P(z("Unknown error"),"error");q.relayList=e.result},xe=()=>{var e;q.recevieData[B.wId]=Fe;const l={type:"config/sos_list",id:B.wId++};null==(e=B.ws)||e.send(A(l))},Be=()=>{q.secondConfirm=!1,Re()},ze=()=>{let e=JSON.stringify(q.form);q.oldFormStr!==e?q.secondConfirm=!0:Re()},Fe=e=>{if(!e.success)return P(z("Unknown error"),"error");q.callList=e.result},Re=()=>{var e;null==(e=null==c?void 0:c.push)||e.call(c,{name:"Security"})},qe=()=>{var e;q.recevieData[B.wId]=Je;const l={type:"config/ak_security/delete",id:B.wId++,ids:[q.form.id]};null==(e=B.ws)||e.send(A(l))},Je=e=>{if(!e.success)return P(z("Unknown error"),"error");Re()},Ge=e=>{q.buttonOkLoading||(q.secondConfirm=!1,q.form.name=q.form.name.trim(),e.validate((e=>{var l,a;if(e){if("edit"===q.type){q.recevieData[B.wId]=Ke;const e={type:"config/ak_security/update",id:B.wId++,securities:[q.form]};q.buttonOkLoading=!0,null==(l=B.ws)||l.send(A(e))}if("add"===q.type){q.recevieData[B.wId]=Ke;const e={type:"config/ak_security/add",id:B.wId++,security:q.form};q.buttonOkLoading=!0,null==(a=B.ws)||a.send(A(e))}}})))},Ke=e=>{var l,a,t;if(q.buttonOkLoading=!1,!e.success)return(null==(l=null==e?void 0:e.error)?void 0:l.code)?P(z(null==(a=null==e?void 0:e.error)?void 0:a.code),"error"):P(z(null==(t=null==e?void 0:e.error)?void 0:t.message),"error");Re()},Qe=e=>R.devicesList.find((l=>(null==l?void 0:l.device_id)===(null==e?void 0:e.device_id)))?e.name:z("The data associated with this component has been deleted.");return t((()=>B.updataId),(e=>{I(q.recevieData,e,B)}),{immediate:!0}),p((()=>{F.value=null,q.recevieData=null})),(e,l)=>{const a=x,t=y,c=_,h=w,p=g,D=b,$=k,U=S;return s(),o("div",ee,[n("div",le,[n("div",ae,[i(a,{class:"security-modify__title-icon","icon-class":"home_Security"}),n("span",te,v(e.$t("Security")),1)])]),n("div",se,[i($,{ref_key:"ruleFormRef",ref:F,model:q.form,rules:J},{default:d((()=>{var a,y,_,w,g;return[n("div",oe,[n("div",ie,[n("div",de,[n("img",{alt:"smart home,home automation,homekit,smart security,smart home systems,google home",src:q.basicShow?"custom"===q.form.type.toLowerCase()?r(T)("security/add_Security_area_Mode.webp"):r(T)(`security/add_Security_${q.form.type.toLowerCase()}_Mode.webp`):r(T)("security/add_Security_area_Mode.webp")},null,8,ne)]),i(c,{prop:"name"},{default:d((()=>[q.basicShow?(s(),o("div",re,v(e.$t(`${q.form.name} Mode`)),1)):(s(),C(t,{key:0,modelValue:q.form.name,"onUpdate:modelValue":l[0]||(l[0]=e=>q.form.name=e),"akubela-test":"security-add-name",maxlength:63,placeholder:e.$t("Please enter a name")},null,8,["modelValue","placeholder"]))])),_:1})]),n("div",ce,[n("div",me,v(e.$t("Any Device Activated"))+":",1),n("div",ue,[(s(!0),o(m,null,u(null==(a=q.form)?void 0:a.activitedDevice,((l,a)=>{return s(),o("div",{key:l.entity_id,class:"modify-devices-row"},[n("div",ve,[i(O,{class:"devices-list-avatar","card-obj":(t=l,R.devicesList.find((e=>(null==e?void 0:e.device_id)===(null==t?void 0:t.device_id)))?t:{device_type:"",product_type:""}),online:!0},null,8,["card-obj"]),n("div",fe,[n("div",ye,[i(M,{content:Qe(l)},null,8,["content"])]),n("div",he,v(l.room?l.room:e.$t("Other")),1)])]),n("div",{class:"devices-content__dele",onClick:e=>(e=>{q.form.activitedDevice.splice(e,1)})(a)},null,8,pe)]);var t})),128)),n("div",_e,[n("div",{class:"modify-devices__img",onClick:l[1]||(l[1]=e=>q.deviceShow=!0)})])])]),n("div",we,[n("div",ge,v(e.$t("Task"))+":",1),n("div",be,[n("div",ke,[i(c,{label:e.$t("Alarm Siren")},{default:d((()=>[i(h,{modelValue:q.form.isSirenOn,"onUpdate:modelValue":l[2]||(l[2]=e=>q.form.isSirenOn=e)},null,8,["modelValue"])])),_:1},8,["label"])]),n("div",{class:f([(null==(y=q.form)?void 0:y.isSendMessage)?"modify-task-bdnone":"","modify-task-check"])},[i(c,{label:e.$t("Send Message")},{default:d((()=>[i(h,{modelValue:q.form.isSendMessage,"onUpdate:modelValue":l[3]||(l[3]=e=>q.form.isSendMessage=e)},null,8,["modelValue"])])),_:1},8,["label"])],2),(null==(_=q.form)?void 0:_.isSendMessage)?(s(),o("div",Se,[i(c,{prop:"messageContent"},{default:d((()=>[i(t,{modelValue:q.form.messageContent,"onUpdate:modelValue":l[4]||(l[4]=e=>q.form.messageContent=e),maxlength:256,autosize:"",type:"textarea",placeholder:e.$t("Please enter content here.")},null,8,["modelValue","placeholder"])])),_:1})])):V("",!0),n("div",{class:f([(null==(w=q.form)?void 0:w.isSendHttpCommand)?"modify-task-bdnone":"","modify-task-check"])},[i(c,{label:e.$t("Send HTTP Command")},{default:d((()=>[i(h,{modelValue:q.form.isSendHttpCommand,"onUpdate:modelValue":l[5]||(l[5]=e=>q.form.isSendHttpCommand=e)},null,8,["modelValue"])])),_:1},8,["label"])],2),(null==(g=q.form)?void 0:g.isSendHttpCommand)?(s(),o("div",Ce,[i(c,{prop:"httpCommand"},{default:d((()=>[i(t,{modelValue:q.form.httpCommand,"onUpdate:modelValue":l[6]||(l[6]=e=>q.form.httpCommand=e),placeholder:e.$t("Please enter content here.")},null,8,["modelValue","placeholder"])])),_:1})])):V("",!0),n("div",Ve,[n("div",Le,v(e.$t("Trigger Relay")),1),n("div",null,[i(D,{modelValue:q.form.relay,"onUpdate:modelValue":l[7]||(l[7]=e=>q.form.relay=e),multiple:"",placeholder:e.$t("Select"),"value-key":"entity_id",size:"large","popper-class":"modify-security-select__more"},{default:d((()=>[(s(!0),o(m,null,u(q.relayList,(e=>(s(),C(p,{key:e.entity_id,label:e.name,value:e},{default:d((()=>[n("div",De,[n("span",$e,v(e.name),1),Ue])])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])]),n("div",Ae,[n("div",Pe,v(e.$t("Make SOS Call")),1),n("div",null,[i(D,{modelValue:q.form.callList,"onUpdate:modelValue":l[8]||(l[8]=e=>q.form.callList=e),"popper-class":"modify-security-select__more",placeholder:e.$t("Select"),multiple:"","value-key":"id",size:"large"},{default:d((()=>[(s(!0),o(m,null,u(q.callList,(e=>(s(),C(p,{key:e.config,label:e.name,value:e.save_config},{default:d((()=>[n("div",Te,[n("span",Oe,v(e.name),1),Ee])])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])]),n("div",Ie,[n("div",He,v(e.$t("Defence Delay")),1),n("div",null,[i(D,{modelValue:q.form.defenceDelay,"onUpdate:modelValue":l[9]||(l[9]=e=>q.form.defenceDelay=e),placeholder:e.$t("Select"),size:"large"},{default:d((()=>[(s(),o(m,null,u(G,(e=>i(p,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue","placeholder"])])]),n("div",Me,[n("div",Ne,v(e.$t("Alarm Delay")),1),n("div",null,[i(D,{modelValue:q.form.alarmDelay,"onUpdate:modelValue":l[10]||(l[10]=e=>q.form.alarmDelay=e),placeholder:e.$t("Select"),size:"large"},{default:d((()=>[(s(),o(m,null,u(G,(e=>i(p,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue","placeholder"])])])])])]),n("div",je,[i(N,{"class-name":"transparentGray","button-name":e.$t("Back"),onClick:ze},null,8,["button-name"]),"edit"!==q.type||q.basicShow?V("",!0):(s(),C(N,{key:0,"class-name":"danger","akubela-test":"scenes-security-modify-del","button-name":e.$t("Delete"),onClick:l[11]||(l[11]=e=>q.deleteShow=!0)},null,8,["button-name"])),L(i(N,{"akubela-test":"scenes-security-modify-save","button-name":e.$t("Save"),onClick:l[12]||(l[12]=e=>Ge(F.value))},null,8,["button-name"]),[[U,q.buttonOkLoading]])])]})),_:1},8,["model","rules"])]),q.deviceShow?(s(),C(Z,{key:0,show:q.deviceShow,"onUpdate:show":l[13]||(l[13]=e=>q.deviceShow=e),"device-selected":q.form.activitedDevice,"onUpdate:deviceSelected":l[14]||(l[14]=e=>q.form.activitedDevice=e)},null,8,["show","device-selected"])):V("",!0),i(E,{show:q.deleteShow,"onUpdate:show":l[15]||(l[15]=e=>q.deleteShow=e),class:"akubela-test-del-mini-security-cfm",title:e.$t("Remove security"),onButtonCancel:l[16]||(l[16]=e=>q.deleteShow=!1),onButtonConfirm:qe},{content:d((()=>[n("div",null,v(e.$t("Are you sure you want to delete this security mode?")),1)])),_:1},8,["show","title"]),q.secondConfirm?L((s(),C(E,{key:1,show:q.secondConfirm,"onUpdate:show":l[17]||(l[17]=e=>q.secondConfirm=e),title:e.$t("Remove security"),onButtonCancel:Be,onButtonConfirm:l[18]||(l[18]=e=>Ge(F.value))},{content:d((()=>[n("div",null,v(e.$t("Do you want to save the Settings?")),1)])),_:1},8,["show","title"])),[[U,q.buttonOkLoading]]):V("",!0)])}}};export{xe as default};
