import{b as e,r as l,l as a,bn as t,bA as d,bw as n,bx as o,bk as r,bj as u,bB as s,bd as i,bm as m,b4 as c,b5 as p,b7 as _,v as f,ba as b,q as h,bc as v,F as g,bl as k,be as y,b9 as V,bf as w}from"./Akubela-element-plus-Vendor-47553b40.js";import{c as x,u as P,at as U,a4 as $,a as T,Q as N,ao as C,ap as I,g as D,d as M,n as j}from"./Akubela-login-home-part-Vendor-facddf88.js";import{_ as A}from"./index-722e1dac.js";import{a as S,s as z}from"./index-8f4b869f.js";import"./Akubela-devices-img-Vendor-0f46fa2c.js";import"./Akubela-scenes-security-other-img-Vendor-2a1534ad.js";const F={class:"add-contacts-list"},L={class:"add-contacts-list-top"},q={class:"card-header"},H=["src"],B=["src"],E={class:"add-contacts-list-top-font"},R={class:"card-header"},W={key:0},Q={key:1},G={class:"card-header"},J={key:0,class:"card-header"},K=/\s*/g,O={__name:"add-contacts",setup(O){const X=x(),Y=S().filter((e=>-1!==e.value)),{t:Z}=P();let ee=z();const le=U(),ae=$(),te={add:Z("Add Contact"),edit:Z("Edit Contact")},de=[{label:Z("Default"),value:0},{label:Z("Customize"),value:1}],ne=[{label:Z("Disabled"),value:0},{label:Z("Enable"),value:1}],oe=["1","2","3","4"],re=e({topType:"add",deleteIndex:0,deleteShow:!1,loading:!1,editId:""});let ue=e({});const se=e({name:"",call_num:"",type:0,unlock_via_http:[{key:"1",name:"",type:0,ip:"",user:"",passwd:"",door:"",command:""}],unlock_via_dtmf:[{name:"",dtmf:"#"},{name:"",dtmf:""},{name:"",dtmf:""}],monitor:{url:"",user:"",passwd:"",display_in_call:0}}),ie=e=>e||"",me=e=>e?Number(e):0,ce=()=>{re.loading=!0,setTimeout((()=>{re.loading=!1}),2e4),ee.getLocalContactsList((e=>{var l,a;re.loading=!1;const t=null==(a=null==(l=ee.loaclContactsList)?void 0:l.find)?void 0:a.call(l,(e=>e.id===re.editId)),d={name:e=>ie(e),call_num:e=>ie(e),type:e=>me(e),unlock_via_http:e=>"array"!==M(e)?ue.unlock_via_http:e.map(((e,l)=>{let a=(null==e?void 0:e.door)?e.door.split(";"):[];return{key:l,name:ie(null==e?void 0:e.name),type:me(null==e?void 0:e.type),ip:ie(null==e?void 0:e.ip),user:ie(null==e?void 0:e.user),passwd:ie(null==e?void 0:e.passwd),door:a,command:ie(null==e?void 0:e.command)}})),unlock_via_dtmf:e=>"array"!==M(e)||3!==(null==e?void 0:e.length)?ue.unlock_via_dtmf:e.map(((e,l)=>({name:ie(null==e?void 0:e.name),dtmf:ie(null==e?void 0:e.dtmf)}))),monitor:e=>"object"!==M(e)?ue.monitor:{url:ie(null==e?void 0:e.url),user:ie(null==e?void 0:e.user),passwd:ie(null==e?void 0:e.passwd),display_in_call:me(null==e?void 0:e.display_in_call)}};for(let n in t)n in d&&(t[n]=d[n](t[n])),se[n]=t[n]}))},pe=(e,l,a)=>{const{domain:t}=e,d=Number(t.type);if(1===d&&!l&&t.command)return a(Z("Please enter a valid name."));if(0===d&&!l&&t.ip)return a(Z("Please enter a valid name."));const n=l.replace(K,""),o=l&&!n,r=C(l)>20,u=I(l);return o||r||u?a(Z("Please enter a valid name.")):a()},_e=(e,l,a)=>{const{domain:t}=e;if(0===Number(t.type)&&!l&&t.name)return a(Z("Please enter a valid IP address."));if(l){if(!/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g.test(l))return a(Z("Please enter a valid IP address."))}return a()},fe=(e,l,a)=>{const{domain:t}=e;if(0===Number(t.type)&&I(l))return a(Z("Please enter a name that only contains numbers, letters and underscores."));if(l){if(!l.replace(K,"")||C(l)>20)return a(Z("Please enter a name that only contains numbers, letters and underscores."))}return a()},be=(e,l,a)=>{const{domain:t}=e;if(1===Number(t.type)){if(l&&!l.startsWith("http://")&&!l.startsWith("https://"))return a(Z("Please enter a valid HTTP address."));const e=C(l)>255,d=t.name&&!l;if(e||d)return a(Z("Please enter a valid HTTP address."))}return a()},he=(e,l,a)=>{const{dtmf:t}=e;if("#"===t)return a();const d=t&&!l;if(I(l),d||I(l))return a(Z("Please enter a valid name."));if(l){if(!l.replace(K,"")||C(l)>20)return a(Z("Please enter a name that only contains numbers, letters and underscores."))}return a()},ve=(e,l,a)=>{const{name:t}=e;if(t&&!l)return a(Z("Please enter a valid DTMF address."));for(let d=0;d<l.length;d++)if(!["0","1","2","3","4","5","6","7","8","9","*","#"].includes(l[d]))return a(Z("Please enter a valid DTMF address."));return a()},ge=(e,l,a)=>{let t=I(l);"monitor.passwd"===(null==e?void 0:e.field)&&(t=!1);const d=C(l)>20;if(t||d)return a(Z("Please enter a name that only contains numbers, letters and underscores."));if(l){if(!l.replace(K,""))return a(Z("Please enter a name that only contains numbers, letters and underscores."))}return a()},ke=l(null);a((()=>{X.mainBackTop(),ue=e(N(se)),re.editId=le.query.id,re.editId&&(re.topType="edit",ce())}));const ye=()=>{se.unlock_via_http.push({key:se.unlock_via_http.length+1,name:"",type:0,ip:"",user:"",passwd:"",door:"",command:""})},Ve=()=>{re.deleteShow=!1},we=e=>{re.deleteIndex=e,re.deleteShow=!0},xe=()=>{se.unlock_via_http.splice(re.deleteIndex,1),Ve()},Pe=()=>{ae.go(-1)},Ue=()=>{ke.value.validate((e=>{if(e){const e=e=>{if(re.loading=!1,!e.success)return j(Z("errorMessage"),"error");ae.push({name:"SetupMode"})},l=N(se);l.unlock_via_http=l.unlock_via_http.map((e=>(delete e.key,"array"===M(e.door)?e.door=e.door.join(";"):e.door="",{...e}))),l.contact_type=l.type,delete l.type,l.monitor.display_in_call=l.monitor.display_in_call?1:0,re.editId&&(l.contact_id=re.editId,delete l.id),re.loading=!0,setTimeout((()=>{re.loading=!1}),2e4),ee.addLoaclList(e,l)}}))},$e=()=>{ae.push({name:"SetupMode"})},Te=e({name:[{required:!0,validator:(e,l,a)=>{l||a(Z("Please enter a name that only contains numbers, letters and underscores."));const t=l.replace(K,""),d=l&&!t,n=I(l),o=C(l)>63;(d||n||o)&&a(Z("Please enter a name that only contains numbers, letters and underscores."));ee.loaclContactsList.filter((e=>re.editId?e.id!==re.editId&&e.name===l:e.name===l)).length&&a(Z("Duplicate Name, please check data uniqueness")),a()},trigger:"change"}],call_num:[{required:!0,validator:(e,l,a)=>{if(!l&&3===se.type)return a();if(!l)return a(Z("Please enter a valid call number."));if(l){let e=["1","2","3","4","5","6","7","8","9","0",".",":"];for(let t=0;t<l.length;t++)if(!e.includes(l[t]))return a(Z("Please enter a valid call number."))}return ee.loaclContactsList.filter((e=>3===se.type?"3"===e.type:"3"!==e.type)).filter((e=>re.editId?e.id!==re.editId&&e.call_num===l:e.call_num===l)).length&&a(Z("Duplicate Call Number, please check data uniqueness")),a()},trigger:"change"}],"monitor.url":[{validator:(e,l,a)=>{const t=!l&&3===se.type,d=C(l)>255,n=l.substring(0,7);return t||d||l&&"rtsp://"!==n?a(Z("Please enter a valid rtsp address.")):a()},trigger:"change"}],"monitor.user":[{validator:ge,trigger:"change"}],"monitor.passwd":[{validator:ge,trigger:"change"}]}),Ne={diplayName:e=>[{validator:pe,trigger:"change",domain:e}],ip:e=>[{validator:_e,trigger:"change",domain:e}],user:e=>[{validator:fe,trigger:"change",domain:e}],password:e=>[{validator:fe,trigger:"change",domain:e}],command:e=>[{validator:be,trigger:"change",domain:e}],lockNameValidNameNew:[{validator:(e,l,a)=>{const t=se.unlock_via_dtmf,d=t[0].dtmf,n=t[1].dtmf,o=t[2].dtmf;t[0].dtmf;const r=t[1].dtmf,u=t[2].dtmf;if(I(l)||(n||o||r||u)&&!l||d&&!l)return a(Z("Please enter a valid name."));if(l){if(!l.replace(K,"")||C(l)>20)return a(Z("Please enter a valid name."))}if("#"===d)return l?a():a(Z("Please enter a valid name."));a()},trigger:"change",unlock_via_dtmf:se.unlock_via_dtmf}],dtmfName:e=>[{validator:he,trigger:"change",dtmf:e}],dtmfVali:e=>[{validator:ve,trigger:"change",name:e}]};return(e,l)=>{const a=t,x=d,P=n,U=o,$=r,N=u,C=s;return i((c(),p("div",F,[_("div",L,[_("div",q,[_("img",{class:"card-header-back",alt:"smart home,home automation,homekit,smart security,smart home systems,google home",src:f(D)("pop_back.webp"),onClick:Pe},null,8,H)]),_("img",{alt:"smart home,home automation,homekit,smart security,smart home systems,google home",class:"add-contacts-list-top__img",src:f(D)("home_contacts.webp")},null,8,B),_("div",E,b(te[re.topType]),1)]),h(C,{ref_key:"ruleFormRef",ref:ke,class:"add-contacts-form",model:se,rules:Te,inline:!0},{default:v((()=>[h($,{class:"contact-box-first"},{default:v((()=>[h(x,{label:e.$t("Name"),prop:"name","label-width":"110"},{default:v((()=>[h(a,{modelValue:se.name,"onUpdate:modelValue":l[0]||(l[0]=e=>se.name=e),placeholder:"",maxlength:63},null,8,["modelValue"])])),_:1},8,["label"]),h(x,{label:e.$t("Call Number"),prop:"call_num","label-width":"110"},{default:v((()=>[h(a,{modelValue:se.call_num,"onUpdate:modelValue":l[1]||(l[1]=e=>se.call_num=e),placeholder:"",maxlength:15},null,8,["modelValue"])])),_:1},8,["label"]),h(x,{label:e.$t("Contacts Type"),"label-width":"110"},{default:v((()=>[h(U,{modelValue:se.type,"onUpdate:modelValue":l[2]||(l[2]=e=>se.type=e),size:"large"},{default:v((()=>[(c(!0),p(g,null,k(f(Y),(e=>(c(),y(P,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"])])),_:1}),0===se.type?(c(),y($,{key:0,class:"add-contacts-card"},{header:v((()=>[_("div",R,[_("div",null,b(e.$t("Unlock via HTTP")),1),_("div",null,[h(N,{type:"primary",size:"large",class:"contacts-button-add",disabled:se.unlock_via_http.length>4,onClick:ye},{default:v((()=>[V(b(e.$t("Add")),1)])),_:1},8,["disabled"])])])])),default:v((()=>[(c(!0),p(g,null,k(se.unlock_via_http,((l,t)=>(c(),p(g,{key:l.key},[_("div",null,[h(x,{label:e.$t("Display Name index",{index:t+1}),"label-width":"110",prop:"unlock_via_http."+t+".name",rules:Ne.diplayName(l)},{default:v((()=>[h(a,{modelValue:l.name,"onUpdate:modelValue":e=>l.name=e,placeholder:"",maxlength:20},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label","prop","rules"]),h(x,{label:e.$t("Type"),"label-width":"110"},{default:v((()=>[h(U,{modelValue:l.type,"onUpdate:modelValue":e=>l.type=e,size:"large"},{default:v((()=>[(c(),p(g,null,k(de,(e=>h(P,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"])]),0===l.type?(c(),p("div",W,[h(x,{label:e.$t("Ip"),"label-width":"110",prop:"unlock_via_http."+t+".ip",rules:Ne.ip(l)},{default:v((()=>[h(a,{modelValue:l.ip,"onUpdate:modelValue":e=>l.ip=e,placeholder:"",maxlength:15},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label","prop","rules"]),h(x,{label:e.$t("Username"),"label-width":"110",prop:"unlock_via_http."+t+".user",rules:Ne.user(l)},{default:v((()=>[h(a,{modelValue:l.user,"onUpdate:modelValue":e=>l.user=e,placeholder:"",maxlength:20},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label","prop","rules"]),h(x,{label:e.$t("Password"),"label-width":"110",prop:"unlock_via_http."+t+".passwd",rules:Ne.password(l)},{default:v((()=>[h(a,{modelValue:l.passwd,"onUpdate:modelValue":e=>l.passwd=e,placeholder:"",maxlength:20},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label","prop","rules"]),h(x,{label:e.$t("Door"),"label-width":"110"},{default:v((()=>[h(U,{modelValue:l.door,"onUpdate:modelValue":e=>l.door=e,multiple:"",size:"large",class:"add-more-select"},{default:v((()=>[(c(),p(g,null,k(oe,(e=>h(P,{key:e,label:e,value:e},null,8,["label","value"]))),64))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"]),t&&se.unlock_via_http.length-1===t?(c(),y(N,{key:0,class:"unlock-delete-button",type:"danger",size:"large",onClick:e=>we(t)},{default:v((()=>[V(b(e.$t("Delete")),1)])),_:2},1032,["onClick"])):w("",!0)])):w("",!0),1===l.type?(c(),p("div",Q,[h(x,{label:e.$t("HTTP Command"),prop:"unlock_via_http."+t+".command",rules:Ne.command(l),"label-width":"110"},{default:v((()=>[h(a,{modelValue:l.command,"onUpdate:modelValue":e=>l.command=e,placeholder:"",class:"contacts-http-input"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label","prop","rules"]),t?(c(),y(N,{key:0,type:"danger",size:"large",onClick:e=>we(t)},{default:v((()=>[V(b(e.$t("Delete")),1)])),_:2},1032,["onClick"])):w("",!0)])):w("",!0)],64)))),128))])),_:1})):w("",!0),0===se.type?(c(),y($,{key:1,class:"add-contacts-card"},{header:v((()=>[_("div",G,b(e.$t("Unlock via DTMF")),1)])),default:v((()=>[_("div",null,[h(x,{label:e.$t("Name index",{index:1}),class:"unlock-name","label-width":"110",prop:"unlock_via_dtmf.0.name",rules:Ne.lockNameValidNameNew},{default:v((()=>[h(a,{modelValue:se.unlock_via_dtmf[0].name,"onUpdate:modelValue":l[3]||(l[3]=e=>se.unlock_via_dtmf[0].name=e),placeholder:"",maxlength:20},null,8,["modelValue"])])),_:1},8,["label","prop","rules"]),h(x,{label:e.$t("Name index",{index:2}),"label-width":"110",prop:"unlock_via_dtmf.1.name",rules:Ne.dtmfName(se.unlock_via_dtmf[1].dtmf)},{default:v((()=>[h(a,{modelValue:se.unlock_via_dtmf[1].name,"onUpdate:modelValue":l[4]||(l[4]=e=>se.unlock_via_dtmf[1].name=e),placeholder:"",maxlength:20},null,8,["modelValue"])])),_:1},8,["label","prop","rules"]),h(x,{label:e.$t("Name index",{index:3}),"label-width":"110",prop:"unlock_via_dtmf.2.name",rules:Ne.dtmfName(se.unlock_via_dtmf[2].dtmf)},{default:v((()=>[h(a,{modelValue:se.unlock_via_dtmf[2].name,"onUpdate:modelValue":l[5]||(l[5]=e=>se.unlock_via_dtmf[2].name=e),placeholder:"",maxlength:20},null,8,["modelValue"])])),_:1},8,["label","prop","rules"])]),_("div",null,[h(x,{label:e.$t("DTMF index",{index:1}),"label-width":"110",prop:"unlock_via_dtmf.0.dtmf",rules:Ne.dtmfVali(se.unlock_via_dtmf[0].name)},{default:v((()=>[h(a,{modelValue:se.unlock_via_dtmf[0].dtmf,"onUpdate:modelValue":l[6]||(l[6]=e=>se.unlock_via_dtmf[0].dtmf=e),placeholder:"",maxlength:8},null,8,["modelValue"])])),_:1},8,["label","prop","rules"]),h(x,{label:e.$t("DTMF index",{index:2}),"label-width":"110",prop:"unlock_via_dtmf.1.dtmf",rules:Ne.dtmfVali(se.unlock_via_dtmf[1].name)},{default:v((()=>[h(a,{modelValue:se.unlock_via_dtmf[1].dtmf,"onUpdate:modelValue":l[7]||(l[7]=e=>se.unlock_via_dtmf[1].dtmf=e),placeholder:"",maxlength:8},null,8,["modelValue"])])),_:1},8,["label","prop","rules"]),h(x,{label:e.$t("DTMF index",{index:3}),"label-width":"110",prop:"unlock_via_dtmf.2.dtmf",rules:Ne.dtmfVali(se.unlock_via_dtmf[2].name)},{default:v((()=>[h(a,{modelValue:se.unlock_via_dtmf[2].dtmf,"onUpdate:modelValue":l[8]||(l[8]=e=>se.unlock_via_dtmf[2].dtmf=e),placeholder:"",maxlength:8},null,8,["modelValue"])])),_:1},8,["label","prop","rules"])])])),_:1})):w("",!0),[0,3].includes(se.type)?(c(),y($,{key:2,class:"add-contacts-card"},{header:v((()=>[0===se.type?(c(),p("div",J,b(e.$t("Monitor")),1)):w("",!0)])),default:v((()=>[_("div",null,[h(x,{label:e.$t("RTSP Address"),prop:"monitor.url","label-width":"110"},{default:v((()=>[h(a,{modelValue:se.monitor.url,"onUpdate:modelValue":l[9]||(l[9]=e=>se.monitor.url=e),placeholder:""},null,8,["modelValue"])])),_:1},8,["label"]),h(x,{label:e.$t("Username"),prop:"monitor.user","label-width":"110"},{default:v((()=>[h(a,{modelValue:se.monitor.user,"onUpdate:modelValue":l[10]||(l[10]=e=>se.monitor.user=e),placeholder:""},null,8,["modelValue"])])),_:1},8,["label"]),h(x,{label:e.$t("Password"),prop:"monitor.passwd","label-width":"110"},{default:v((()=>[h(a,{modelValue:se.monitor.passwd,"onUpdate:modelValue":l[11]||(l[11]=e=>se.monitor.passwd=e),placeholder:""},null,8,["modelValue"])])),_:1},8,["label"]),3===se.type?(c(),y(x,{key:0,label:e.$t("Display In Call"),"label-width":"110"},{default:v((()=>[h(U,{modelValue:se.monitor.display_in_call,"onUpdate:modelValue":l[12]||(l[12]=e=>se.monitor.display_in_call=e),size:"large"},{default:v((()=>[(c(),p(g,null,k(ne,(e=>h(P,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1},8,["label"])):w("",!0)])])),_:1})):w("",!0)])),_:1},8,["model","rules"]),h(A,{onCancel:$e,onSubmit:Ue}),h(T,{show:re.deleteShow,"onUpdate:show":l[13]||(l[13]=e=>re.deleteShow=e),"button-cancel-show":!0,"button-ok-name":e.$t("Confirm"),onButtonCancel:Ve,onButtonConfirm:xe},{content:v((()=>[_("div",null,b(e.$t("Are you sure you want to delete this HTTP command?")),1)])),_:1},8,["show","button-ok-name"])],512)),[[m,!re.loading]])}}};export{O as default};
