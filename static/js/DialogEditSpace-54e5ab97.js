import{b as e,l as a,j as d,w as l,b4 as i,b5 as o,q as r,bc as s,b7 as n,ba as t,cc as c}from"./Akubela-element-plus-Vendor-47553b40.js";import{j as u,u as v,w as p,s as m,a as _,m as h,n as w}from"./Akubela-login-home-part-Vendor-facddf88.js";import"./Akubela-devices-img-Vendor-0f46fa2c.js";import"./Akubela-scenes-security-other-img-Vendor-2a1534ad.js";const b={class:"device-dia-space"},f={class:"device-advanced-box-dia"},g={class:"device-advanced-tit"},j={__name:"DialogEditSpace",props:{show:{type:Boolean,required:!0,default:!1}},emits:["update:show"],setup(j,{emit:O}){const V=j;let D=u();const{t:L}=v(),k={expandTrigger:"hover",value:"area_id",label:"name"};let A=p();const C=e({acceptData:{},sendAreaObj:{},spaceValue:"",newRoomList:[]});a((()=>{I()}));const R=d({get:()=>V.show,set:e=>{O("update:show",e)}}),I=()=>{var e,a,d,l;C.newRoomList=null==(l=null==(d=null==(a=null==(e=D.newRoomList)?void 0:e.map)?void 0:a.call(e,(e=>({...e,name:L(null==e?void 0:e.name)}))))?void 0:d.filter)?void 0:l.call(d,(e=>!("all"===e.area_id||"public"===e.area_id))),M()},y=e=>{const a=e[e.length-1];for(let d=0;d<C.newRoomList.length;d++){const e=C.newRoomList[d];if(e.area_id===a){C.sendAreaObj=e;break}for(let d=0;d<e.children.length;d++){const l=e.children[d];if(l.area_id===a){C.sendAreaObj=l;break}}}},E=()=>{var e,a,d,l,i,o;C.acceptData[A.wId]=B;const r={type:"config/ak_device/update",id:A.wId++,device_id:null==(e=D.deviceCardObj.deviceDetail)?void 0:e.device_id,area_id:null==(d=null==(a=C.spaceValue)?void 0:a.pop)?void 0:d.call(a)};(null==(i=null==(l=D.roomList)?void 0:l.find)?void 0:i.call(l,(e=>e.area_id===r.area_id)))||(C.acceptData[A.wId]=e=>{if(!e.success)return w(L("errorMessage"),"error");x()},D.getRoomList()),"Other"===r.area_id&&(r.area_id=""),null==(o=A.ws)||o.send(h(r))},x=()=>{var e,a,d,l;C.acceptData[A.wId]=B;const i={type:"config/ak_device/update",id:A.wId++,device_id:null==(e=D.deviceCardObj.deviceDetail)?void 0:e.device_id},o=null==(d=null==(a=D.roomList)?void 0:a.find)?void 0:d.call(a,(e=>e.name===C.sendAreaObj.name));if(!(null==o?void 0:o.area_id))return w(L("errorMessage"),"error");i.area_id=null==o?void 0:o.area_id,"Other"===(null==o?void 0:o.area_id)&&(i.area_id=""),null==(l=A.ws)||l.send(h(i))},B=e=>{if(!(null==e?void 0:e.success))return w(L("errorMessage"),"error");O("update:show",!1)},M=()=>{var e,a;let d=[];D.newRoomList.forEach((e=>{var a,l,i;(null==e?void 0:e.area_id)===(null==(a=D.deviceCardObj.deviceDetail)?void 0:a.area_id)&&(null==(l=null==d?void 0:d.push)||l.call(d,null==e?void 0:e.area_id)),(null==(i=null==e?void 0:e.children)?void 0:i.length)>0&&e.children.forEach((a=>{var l;(null==a?void 0:a.area_id)===(null==(l=D.deviceCardObj.deviceDetail)?void 0:l.area_id)&&(d=[e.area_id,a.area_id])}))})),(null==(e=D.deviceCardObj.deviceDetail)?void 0:e.area_id)||null==(a=null==d?void 0:d.push)||a.call(d,"Other"),C.spaceValue=d};return l((()=>A.updataId),(e=>{m(C.acceptData,e,A)}),{immediate:!0}),(e,a)=>{const d=c;return i(),o("div",b,[r(_,{show:R.value,"onUpdate:show":a[1]||(a[1]=e=>R.value=e),"foot-show":!0,title:e.$t("Edit Space"),onButtonCancel:a[2]||(a[2]=e=>O("update:show",!1)),onButtonConfirm:E},{content:s((()=>[n("div",f,[n("div",g,t(e.$t("space")),1),n("div",null,[r(d,{modelValue:C.spaceValue,"onUpdate:modelValue":a[0]||(a[0]=e=>C.spaceValue=e),"popper-class":"dia-space-cascader",options:C.newRoomList,props:k,separator:"-",onChange:y},null,8,["modelValue","options"])])])])),_:1},8,["show","title"])])}}};export{j as default};
